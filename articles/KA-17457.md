---
title: '"Problemi critici comuni AEM'
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: “KCS”
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Victoria Barnato
article-created-date: "2/22/2023 9:05:10 PM"
article-published-by: Victoria Barnato
article-published-date: "4/3/2023 8:05:17 PM"
version-number: 7
article-number: KA-17457
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d9614f94-f4b2-ed11-83fe-6045bd0067ea"
source-git-commit: b54e9cc097e838cf9033e85ca2b7d5e1e636f4ad
workflow-type: tm+mt
source-wordcount: '1930'
ht-degree: 4%

---

# Problemi critici comuni AEM

## Descrizione {#description}


Questo articolo descrive i problemi critici più comuni AEM e come analizzarli.

- Prestazioni AEM Sites
- Prestazioni AEM Assets
- Problemi di memoria
- Problemi di indicizzazione
- Problemi di replica
- Problemi di corruzione TarMK



## Risoluzione {#resolution}

Problemi di prestazioni di AEM Sites<br>
<b>Sintomi di un problema di prestazioni</b>

1. Caricamento lento delle pagine
2. Creazione o modifica lente delle pagine
3. I tempi di risposta AEM sono lenti
4. AEM non risponde per alcune richieste
5. Il AEM request.log on mostra tempi di risposta lenti


<b>Cosa causa problemi di prestazioni</b>

1. Contesto dei thread : richieste con esecuzione lunga, ad esempio ricerche lente, lavori in background con scrittura pesante, spostamento di interi rami di contenuto del sito, ecc.
2. Elevato utilizzo della CPU
3. Richieste onerose come costose ricerche o codice applicazione inefficiente, componenti, ecc.
4. Mancanza di una manutenzione adeguata
5. Memorizzazione in cache del dispatcher insufficiente
6. Mancanza di CDN
7. Mancanza di cache del browser
8. Troppi script caricati sulla pagina e caricati nella parte superiore della pagina
9. CSS caricati in tutta la pagina invece che nell’intestazione di HTML
10. Dimensionamento insufficiente del server o architettura errata
11. Problemi di memoria (vedi sotto)


<b>Come analizzare il problema delle prestazioni</b>

1. [Cattura una serie di immagini thread](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17452.html?lang=it) e [analizzarli](https://helpx.adobe.com/it/experience-manager/kb/thread-dump-analysis.html).
2. Controlla a livello di sistema operativo se il processo AEM java sta causando un elevato utilizzo della CPU:    
   - Linux: utilizza il comando superiore per controllare l&#39;utilizzo della CPU.
   - Finestra: utilizzare Gestione attività di Windows

    Se AEM causa un elevato utilizzo della CPU, esegui lo strumento di profilazione predefinito per alcuni minuti e analizza il risultato.
3. [Analizza il file request.log per eventuali richieste lente](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/monitoring-and-maintaining.html?lang=en#interpreting-the-request-log).
4. Rivedi le procedure di manutenzione del sistema. Vedi questo [articolo](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/monitoring-and-maintaining.html)per informazioni dettagliate sulla manutenzione AEM e assicurarsi di effettuare una manutenzione adeguata su AEM, tra cui: - Pulizia revisioni (solo MongoMK e Database DocumentNodeStore) - ogni giorno o più frequente - Compattazione Tar offline (solo TarMK) - bisettimanale - Archivio dati Raccolta rifiuti (solo sistemi con FileDataStore o S3 DataStore) - settimanale - Pulizia del flusso di lavoro - settimanale Pulizia della versione - settimanale - Pulizia del log di controllo - settimanale 5. Rivedi le strategie di caching implementate al dispatcher livello.
6. Rivedi la memorizzazione in cache del tuo sito.
7. Utilizza strumenti di analisi del sito lato client come <b>Audit</b> funzionalità nel browser Google Chrome <b>Strumenti per gli sviluppatori</b> pannello.  Questi strumenti ti daranno consigli su miglioramenti delle prestazioni lato client.


<b>Soluzioni ai problemi di prestazioni comuni</b>

- Fai riferimento a [articolo](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17486.html?lang=it) per passaggi dettagliati su come ottimizzare le prestazioni.
- Consulta la sezione [suggerimenti per l&#39;ottimizzazione delle prestazioni](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17466.html?lang=it)

<br> Problemi di prestazioni di AEM Assets<br> 
<b>Sintomi di un problema di prestazioni di Assets</b>

- Caricamento lento dei file su /assets.html o /damadmin UI
- Le miniature richiedono troppo tempo per essere generate
- Le operazioni relative alle risorse, come spostare, eliminare, modificare e aggiornare i metadati, richiedono troppo tempo


<b>Cosa causa problemi con le prestazioni di Assets</b>

- Mancanza di una manutenzione adeguata
- Pacchetti correzioni più recenti non applicati
- Ottimizzazioni non applicate
- Ridimensionamento inadeguato del server per il caricamento dell&#39;utente


<b>Come analizzare il problema delle prestazioni delle risorse</b>

- [Esamina i passaggi 1-4 dell’analisi delle prestazioni dei siti di cui sopra](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17457.html#performance-analysis).

<b>Soluzioni ai problemi di prestazioni comuni di Assets</b>
- Consulta la sezione [Guida all’ottimizzazione delle prestazioni di AEM Assets](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/assets-performance-sizing.html?lang=en).
- È possibile trovare soluzioni ad alcuni scenari di problemi e alle relative soluzioni [qui](https://helpx.adobe.com/experience-manager/kb/comon-aem-assets-ingestion-issues.html).
- Ottimizzare le prestazioni di elaborazione delle risorse, vedi [articolo](https://helpx.adobe.com/experience-manager/kb/Asset-Performance-Tuning.html).

<br>Problemi di memoria<br>
<b>Sintomi di un problema di memoria</b>

- AEM si arresta in modo casuale e nei log OutOfMemoryError viene osservato
- AEM diventa più lento nel tempo e alla fine si blocca
- AEM non risponde


<b>Come diagnosticare un problema di memoria</b>

- Cerca nei file di registro per OutOfMemoryError, se trovi delle corrispondenze allora hai un problema di memoria
- Rivedi http://*aem-host:port*/system/console/memoryusage screen

   Se l&#39;utilizzo di &quot;Old Generation&quot; (JDK 7 e versioni precedenti) o &quot;Tenured Generation&quot; (JDK8 o versioni successive) è elevato, questo potrebbe essere un segno di un problema di utilizzo della memoria heap.  Fai clic su &quot;Esegui Garbage Collector&quot; per richiedere alla JVM di eseguire una raccolta completa di oggetti inattivi heap.  Se l&#39;elevato utilizzo dell&#39;heap rimane elevato dopo la richiesta di GC, allora c&#39;è probabilmente un problema.  Su un&#39;istanza AEM con archiviazione Oak Tar, se l&#39;utilizzo tenure è superiore a 3 GB, allora potrebbe esserci un problema.  L&#39;elevato utilizzo di heap su un sistema con archiviazione Mongo potrebbe essere dovuto alla configurazione della cache in-memory.
- [Prendere immagini thread e output superiore](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17452.html?lang=it#) ed eseguire [analisi dei thread](https://helpx.adobe.com/it/experience-manager/kb/thread-dump-analysis.html).  Controlla se i thread che causano un elevato utilizzo della CPU sono thread nativi JVM Garbage Collection.  Se il thread che utilizza il tempo più elevato della CPU è il &quot;Thread VM&quot; o qualsiasi thread di raccolta degli oggetti inattivi, è probabile che si verifichi un problema di memoria.


<b>Cosa causa problemi di memoria</b>

- Perdita di memoria dell&#39;applicazione Java
- Sovrapposizione di Java Finalizer a causa di un uso non corretto della finalizzazione nel codice personalizzato
- Configurazione max heap insufficiente


<b>Come analizzare la causa del problema di memoria</b>

Vedi [articolo](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17482.html?lang=it) per informazioni su come acquisire un’immagine heap.

Il modo migliore per identificare la causa di un problema di memoria è quello di analizzare un’immagine heap.

Una volta catturato un file Heap Dump, aprilo in [MAT Eclipse](http://www.eclipse.org/mat/) o [IBM Memory Analyzer](https://developer.ibm.com/languages/java/) strumento.  In Eclipse MAT, esegui il rapporto Perdita sospette e apri la visualizzazione &quot;Dettagli thread&quot; per vedere le potenziali cause del problema di memoria.

<b>Soluzioni ai problemi di memoria comuni</b>

- Ottimizza il codice dell&#39;applicazione per utilizzare meno memoria se noti lunghe pause per la raccolta degli oggetti inattivi.  La maggior parte dei problemi di Garbage Collection può essere risolta al meglio ottimizzando l’applicazione rispetto alla messa a punto di JVM.
- Se hai già ottimizzato la tua applicazione e riscontri ancora lunghe pause GC, allora [concentrarsi sulla messa a punto della JVM](https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/).

<br>Problemi di indicizzazione AEM<br>
<b>Sintomi dei problemi di indicizzazione</b>

Di seguito sono riportati i segnali di un problema di indicizzazione AEM/Oak:

- I risultati della ricerca sono obsoleti di più di 10 minuti
- Mancano risultati di ricerca
- Gli errori vengono restituiti nell’interfaccia utente o nei registri durante la ricerca tramite l’interfaccia utente del sito, la ricerca Query Builder o l’esecuzione della query JCR

<b>Come diagnosticare un problema di indicizzazione</b>
Per vedere se l’indicizzazione asincrona è lenta o non riesce, procedi come segue:
1. Apri questi URL nell’istanza AEM per visualizzare le statistiche sull’indicizzatore asincrono http://aemhost:port/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3Dasync%2Ctype%3DIndexStats http://aemhost:port/system/console/jmx/org.apache.jackrabbit.oak%3Aname%3Dfulltext-async%2Ctype%3DIndexStats  - This l’URL si applica solo a AEM6.2 e versioni successive
2. In ciascuna di queste pagine, controlla i campi seguenti:

   <b>FailingSince</b> - Indica quando l&#39;indicizzazione ha iniziato a non funzionare.

   <b>LastError</b> - Questa è la traccia della pila che mostra cosa sta causando il mancato funzionamento dell&#39;indicizzazione.  Se questo è vuoto, l&#39;indicizzazione non genera errori.

   <b>LastErrorTime</b> - Indica l&#39;ultima volta che l&#39;indicizzazione ha generato l&#39;errore.

   <b>LastIndexedTime</b> - Se la data e l&#39;ora di questo campo hanno più di 5 minuti, l&#39;indicizzazione è troppo lenta.


<b>Cosa causa problemi con l&#39;indicizzazione</b>

- Manutenzione impropria o mancata manutenzione, come Revision Garbage Collection, Pulizia del flusso di lavoro, Pulizia dei controlli, Pulizia delle versioni, ecc.
- Segmenti corrotti o mancanti nell&#39;archiviazione Tar
- Revisione della corruzione in un ambiente cluster (DocumentNodeStore - Mongo o Database)
- Problema con la topologia del cluster in un ambiente cluster


<b>Come analizzare ciò che sta causando problemi di indicizzazione</b>

- Vedi [articolo](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17492.html?lang=it) per l’analisi e la correzione dei problemi di indicizzazione

<br>Problemi di replica<br>
<b>Sintomi dei problemi di replica</b>

- Le richieste di pubblicazione sono in coda nella coda dell’agente di replica
- Il contenuto pubblicato non viene visualizzato sul server di pubblicazione
- Impatto sulle prestazioni del sistema


<b>Cosa causa problemi di replica:</b>

- L&#39;agente di replica non è configurato correttamente e non può connettersi all&#39;agente di pubblicazione
- Si verifica un errore al momento della replica che blocca la coda di replica
- Il sistema è lento e le repliche vengono elaborate lentamente
- La replica avviene come parte di un flusso di lavoro personalizzato e il problema è l’elaborazione del flusso di lavoro.


<b>Come analizzare i problemi di replica:</b>

1. Controlla la coda di replica [status](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/replication.html?lang=it):

   <b>Attivo:</b> quando gli elementi vengono elaborati.

   <b>Inattivo:</b> quando la coda è vuota.

   <b>Bloccato:</b> quando gli elementi sono in coda, ma non possono essere elaborati; ad esempio, quando l&#39;agente punta a un host inattivo o inesistente.
2. Controlla le configurazioni di replica se il server è clonato o se l’agente è stato configurato di recente. Per maggiori dettagli, vedi [qui](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/configuring/replication.html?lang=en#configuring-your-replication-agents-from-the-author-environment).
3. Esamina i registri dell’agente di replica in <b>http://host:port/etc/replication/agents.author/AgentName.log.html#end</b>.  Se non riesci a identificare alcun elemento, raccogli questo registro e presentalo per AEM supporto.
4. Esamina il server error.log da <b>AEMinstall/crx-quickstart/logs</b>; Se non riesci a identificare alcun elemento, raccogli questo registro e presentalo per AEM supporto.
5. Se la coda di replica è in stato &quot;inattivo&quot; e non si applica nessuno dei precedenti, in questo caso il problema è probabilmente causato dai flussi di lavoro. Se i flussi di lavoro non vengono elaborati, l’elemento di replica non arriva mai alla coda di replica. Per monitorare lo stato dei flussi di lavoro, puoi controllare il dashboard del flusso di lavoro per controllare il numero di istanze del flusso di lavoro in esecuzione. Informazioni sull’amministrazione dei flussi di lavoro [qui](https://experienceleague.adobe.com/docs/experience-manager-65/administering/operations/workflows.html).
6. Le replicazioni rallentano quando il sistema è sotto carico elevato o si verificano altri problemi di prestazioni.


<b>Soluzione ai problemi di replica comuni:</b>

1) [Esamina i problemi della coda di replica](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17467.html?lang=it)
2) Se il problema è dovuto a flussi di lavoro che non funzionano in modo efficiente, è possibile rivedere il [suggerimenti per l’elaborazione del flusso di lavoro](https://experienceleague.adobe.com/docs/experience-manager-65/developing/extending-aem/extending-workflows/workflows-process-ref.html?lang=en)
<br>Problemi di corruzione TarMK<br>
<b>Sintomi di corruzione TarMK</b>

- L&#39;istanza è inutilizzabile dopo la compattazione offline.
- Istanza bloccata in <b>Avvio in corso</b> stato.
- File di registro o rapporto di output del comando di compattazione <b>SegmentNotFoundException</b>.


<b>Cosa causa i problemi di corruzione</b>

- Il segmento viene rimosso con un intervento manuale (ad esempio rm -rf ).
- Il segmento viene rimosso dalla revisione della raccolta degli oggetti inattivi o non può essere trovato a causa di alcuni bug nel codice.
- Non è possibile trovare il segmento a causa di un bug nel codice.
- Le varie attività di manutenzione non vengono eseguite in tempo, con conseguente crescita dell&#39;archivio e poco spazio su disco.
- Arrestare con forza AEM uccidendo il processo java.


<b>Come diagnosticare i problemi di corruzione dell’archivio:</b>

- Rivedi il file error.log e controlla se è presente <b>SegmentNotFoundException</b> o <b>Eccezione IllegalArgument</b>.
- Per determinare se un segmento è stato rimosso dalla revisione della raccolta degli oggetti inattivi, controlla l&#39;output del logger org.apache.jackrabbit.oak.plugins.segment.file.TarReader-GC (abilita il registro di debug). Il logger registra gli ID segmento di tutti i segmenti rimossi dalla fase di pulizia. Solo quando l’ID del segmento che ha commesso l’errore viene visualizzato nell’output di quel logger, la causa dell’eccezione è la revisione della raccolta degli oggetti inattivi.
- In caso di corruzione nel datastore esterno, cerca nel file di log tutte le occorrenze di errore <b>Errore durante l&#39;ottenimento di InputStream per blobId</b>. Questo errore significa che mancano i file dalla directory del datastore AEM.


<b>Soluzione per risolvere i problemi di corruzione:</b>

- Determinare l’ultima revisione valida nota dell’archivio segmenti utilizzando [check](https://github.com/apache/jackrabbit-oak/blob/trunk/oak-run/README.md#check) modalità di esecuzione di oak-run.  Ripristina manualmente l’archivio dei segmenti corrotti alla sua ultima revisione valida. Questa operazione ripristina l’archivio Oak in uno stato precedente nel tempo.  È necessario eseguire il backup completo dell&#39;archivio prima di eseguire questa operazione.
   - Per eseguire il controllo e il ripristino, segui i passaggi indicati in [articolo](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-16542.html?lang=it).
   - Se il controllo non riesce con <b>ConsistencyChecker - Non sono state trovate revisioni valide</b> quindi implementa i passaggi della parte B di [articolo](https://helpx.adobe.com/experience-manager/kb/offline-compaction-fails-with-SegmentNotFoundException-and-IllegalArgumentException.html).
- Se non utilizzi un archivio dati, utilizza un file esterno, S3 o Azure datastore, invece dell’archivio segmenti predefinito.
   - L&#39;utilizzo di un datastore fornisce prestazioni migliori.
   - Esegui la migrazione dell’istanza a una con un datastore utilizzando [crx2oak](https://experienceleague.adobe.com/docs/experience-manager-65/deploying/upgrading/using-crx2oak.html?lang=en).
- Applica l&#39;ultimo Service Pack e Cumulative Fix Pack e Oak Cumulative Fix Pack.



