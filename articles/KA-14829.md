---
title: Campaign Classic V7 - Cos'è il modulo db pg_stat_statement? A cosa serve?
description: Descrizione
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: https://wiki.corp.adobe.com/pages/viewpage.action?spaceKey=neolane&title=Database+performance+optimization+-+Identify+bottleneck+queries+with+execution+statistics#Databaseperformanceoptimization-Identifybottleneckquerieswithexecutionstatistics-pg_stat_statements
bug: false
article-created-by: Marta Zator
article-created-date: 5/4/2022 4:36:53 PM
article-published-by: Marta Zator
article-published-date: 5/4/2022 4:38:25 PM
version-number: 2
article-number: KA-14829
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=aa74c765-c8cb-ec11-a7b5-6045bd00d4f5
exl-id: ad0f34e4-bf33-4eef-a290-7b0a3e92a6c9
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '350'
ht-degree: 1%

---

# Campaign Classic V7 - Cos&#39;è il modulo db pg_stat_statement? A cosa serve?

## Descrizione


1. Che cos&#39;è il modulo db pg_stat_statement ?

2. Perché viene richiesto di abilitare i client?

3. Come viene attivato?






## Risoluzione




1.  Il modulo pg_stat_statement fornisce un mezzo per il tracciamento delle statistiche di esecuzione di tutte le istruzioni SQL eseguite da un server.

Il modulo deve essere caricato aggiungendo pg_stat_statement alle librerie_preload_shared in postgresql.conf, perché richiede ulteriore memoria condivisa. Ciò significa che è necessario riavviare il server per aggiungere o rimuovere il modulo.

Collegamento : [https://www.postgresql.org/docs/9.4/pgstatstatements.html](https://www.postgresql.org/docs/9.4/pgstatstatements.html)



2. Implementare uno schema di tipo di visualizzazione in questa tabella che ci consente di monitorare le query che richiedono molto tempo. In questo modo i client potranno ottimizzare le prestazioni e ottimizzare quelle funzionalità.

Questa estensione fornisce metriche sull&#39;esecuzione delle query : che sono le query eseguite più frequentemente e quanto tempo ciascuna richiede.



3.  <b>pg_stat_statement </b>

1. Verifica che sia installato il pacchetto di input PostgreSQL ufficiale per la versione postgres.

$ dpkg -l | grep postgres postgresql-contributi-9.3

Se non è installato, installalo.

$ apt-get installa postgresql-contributi-9.3

2. Cambia postgresql.conf per precaricare il modulo all&#39;avvio

Predefinito : shared_preload_librerie = &#39;&#39; Nuovo : shared_preload_librerie = &#39;pg_stat_statement&#39; — se si utilizzano sia pg_stat_statement che auto_spiegare, utilizzare un record ONE e separarsi con virgole shared_preload_librerie = &#39;auto_spiegare,pg_stat_statement&#39;

3. Nel database da monitorare, esegui CREATE query :

— nessuna creazione di estensione richiesta per auto_spiegare, solo per pg_stat_statement psql postgres=# \c mydatabase mydatabase=# CREATE EXTENSION pg_stat_statement;

4. Nella sezione OPTIONS PERSONALIZZATI di postgresql.conf, aggiungi le righe:

pg_stat_statement.max = 5000 pg_stat_statement.track = all pg_stat_statement.save = on

5. Riavvia l&#39;esempio del servizio postgresql : Ottieni le 5 query più costose nei database

query SELECT, chiamate, tempo_totale, righe, 100.0\*shared_blks_hit/nullif(shared_blks_hit+shared_blks_read,0) hit_percent AS da pg_stat_statement come join interno pg_database come d su d.oid = s.dbid dove d.datname = ordine &#39;Nome_database&#39; per limite di desc 5 total_time;
