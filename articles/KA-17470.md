---
title: "Errore: Troppi file aperti"
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "10/20/2021 11:05:19 PM"
article-published-by: Roxann McGlumphy
article-published-date: "10/20/2021 11:10:07 PM"
version-number: 1
article-number: KA-17470
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=dc40aa30-fa31-ec11-b6e5-000d3a5ba97a"
exl-id: 534227cf-df15-4255-b699-e26953bf90e6
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '732'
ht-degree: 1%

---

# Errore: Troppi file aperti

## Descrizione

<br><br><br>Problema<br><br><br><br><br><br>
I file di registro contengono l&#39;errore &quot;Troppi file&quot; e AEM non risponde.
<br><br><br><br><br><br>Causa<br><br><br><br><br><br>
La causa è una delle due possibilità:

- L&#39;applicazione non chiude risorse come file o socket dopo averli utilizzati.
- Oppure l&#39;applicazione richiede più file aperti di quanto consentito dal processo.



## Risoluzione

<br><br> <br><br><br><br><br><br>
La soluzione a questo problema è:

1. Scopri cosa causa il raggiungimento del limite di file aperti
2. Aumenta il limite o correggi i bug dell’applicazione.

<br><br><br><br>Trova i file o le prese che rimangono aperti<br><br> <br><br>
\*\* I limiti dei file aperti si applicano ai file aperti, ai tubi e alle prese combinati totali, non solo ai file.

Sulla piattaforma Linux, il comando lsof può essere utilizzato per eseguire il debug delle risorse che sono tenute aperte dal processo.

Ecco uno script di esempio per raccogliere utili elenchi di output:
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6<br>  7<br>  8<br>  9<br>  10<br>  11<br>  12<br>  13<br>  14<br>  15<br>  16<br>  17<br>  18<br>  19<br>  20<br>  21 | `#!/bin/bash``if` `$``# -eq 0``  ``then``    ``echo` `"No PID specified"``    ``echo` `"Run command with PID, for example:"``    ``echo` `"lsof-script.sh 12345"``    ``exit` `2``fi`<br>   <br>  `JAVA_PROCESS_PID=$1`<br>   <br>  `lsof` `-p $JAVA_PROCESS_PID``lsof``-output-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Files open by the process:"``cat` `lsof``-output-$JAVA_PROCESS_PID.txt | ``wc` `-l`<br>   <br>  `echo` `"Generated output file with counts of grouped open files lsof-sorted-counts-$JAVA_PROCESS_PID.txt"``cat` `lsof``-output-$JAVA_PROCESS_PID.txt |``awk` `'{print $9}'` `|``sed` `-e``"s/\(.*\)\(segmentstore\).*$/\1\2/"` `| ``sed` `-e``"s/\(.*\)\(repository/index\).*$/\1\2/"` `|``sed` `-e``"s/\(.*\)\(felix/bundle\).*$/\1\2/"` `| ``sed` `-e``"s/\(.*\)\(/lib\).*$/\1\2/"` `| ``sed` `-e``"s/\(.*\)\(/logs\).*$/\1\2/"` `| ``sed` `-e``"s/\(.*\)\(/ext\).*$/\1\2/"` `|``sort` `|``uniq` `-c |``sort` `-rn -k1``lsof``-sorted-counts-$JAVA_PROCESS_PID.txt`<br>   <br>  `echo` `"Total open files in OS:"``lsof` `|``wc` `-l` |
| --- | --- |

<br><br><br><br><br> <br><br>
Output campione:
<br><br><br><br><br> <br><br><br><br>

| 1<br>  2<br>  3<br>  4<br>  5<br>  6 | `$ ./lsof-script.sh 18070``Files open by the process:``    ``1995``Generated output file with counts of grouped open files: lsof-sorted-counts-18070.txt``Total open files in OS:``   ``18399` |
| --- | --- |

<br><br><br><br><br> <br><br>
Inspect l&#39;output del file lsof-ordered-count-\*.txt generato.  Mostra quali file o socket sono attualmente aperti dal processo.

Se trovi i socket aperti o i file elencati che non dovrebbero ancora essere aperti, è probabile che sia dovuto a un bug dell&#39;applicazione.  Aggiorna il codice dell&#39;applicazione per chiudere i file e i socket dopo averli utilizzati.

Una causa comune del persistere di socket aperti è il codice personalizzato che rende il servizio Web.  In molti casi, vengono utilizzate librerie come Apache Commons HttpClient, ma le connessioni non vengono mai chiuse dagli sviluppatori.  Vedi [articolo](https://stackoverflow.com/questions/43454514/proper-usage-of-apache-httpclient-and-when-to-close-it) per informazioni dettagliate su Apache Commons HttpClient.
<br><br><br><br> <br><br>Aumenta il limite per la sessione shell<br><br><br><br> <br><br>
Controlla il limite dell&#39;utente per il numero massimo di file aperti, quindi esegui quanto segue come lo stesso utente che AEM processo viene eseguito come:

ulimit -Sn ulimit -Hn

Quando utilizzi lo script iniziale predefinito di AEM/CQ, procedi come segue per aumentare il limite:

1. Apri crx-quickstart/bin/start per la modifica
2. Aggiungi la variabile CQ_MAX_OPEN_FILES nella parte superiore dello script: CQ_MAX_OPEN_FILES=8192 esporta CQ_MAX_OPEN_FILES


Se vedi l&#39;errore &quot;-bash: ulimit: file aperti: impossibile modificare il limite: Operazione non consentita&quot; all&#39;avvio di AEM, la configurazione di cui sopra non funziona.

Invece, è necessario aumentare il limite in /etc/security/limits.conf. Vedi di seguito per i dettagli su come riconfigurare il limite utente.

Se utilizzi un server applicazioni di terze parti come JBoss o Websphere, segui le sezioni seguenti e verifica con la documentazione del fornitore.

Nota:

Se nessuna delle configurazioni di questo articolo risolve il problema, vedi quali file sono aperti utilizzando il comando lsof -p. (-p è l&#39;id del processo problematico.) Potrebbe essere che l&#39;applicazione stia lasciando aperti gli handle di file. Se vedi che le maniglie sono tenute principalmente da AEM e non dalla tua applicazione, contatta il supporto.


<br><br><br><br> <br><br>Aumentare i limiti dell&#39;utente<br><br><br><br> <br><br>
Per modificare il numero massimo di file aperti per gli utenti non root, modifica il file /etc/security/limits.conf. Puoi impostare il limite per ciascun utente:

crx_process_username soft nofile 8092

crx_process_username hard nofile 20000

Nota:

Questa configurazione ha effetto solo al successivo accesso dell&#39;utente.


<br><br><br><br> <br><br>Aumenta il limite del sistema<br><br><br><br> <br><br>
A volte, il limite utente è abbastanza alto, ma il sistema stesso ha raggiunto il suo numero massimo di file. Esegui quanto segue come utente su/root:

1. Controlla l&#39;impostazione massima del file aperto sul sistema operativo (se è inferiore a 20000, allora ha senso aumentare questa impostazione).    cat /proc/sys/fs/file-max
2. Aggiungi questa riga a /etc/sysctl.conf per aumentare il valore massimo del file aperto del sistema: fs.file-max = 300000
3. Esegui questo comando: sysctl -p
4. Verifica che il nuovo valore sia visualizzato quando esegui questo comando: cat /proc/sys/fs/file-max


Nota:

Questa configurazione ha effetto solo al successivo accesso dell&#39;utente.


<br><br><br><br> <br><br>Informazioni aggiuntive<br><br><br><br> <br><br>
Questo errore si verifica quando il sistema o l&#39;utente sta utilizzando i relativi handle di file con numero massimo.

SCARICA
[Ottieni file](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/TooManyOpenFiles/jcr:content/main-pars/kb_download/check_open_files.sh "check_open_files.sh") <br><br>Script shell che è possibile utilizzare per monitorare l’utilizzo del file aperto. Usa questo script solo se l&#39;errore &quot;troppi file aperti&quot; persiste anche dopo l&#39;aumento del massimo. Oppure, puoi usarlo se pensi che CRX o che l&#39;applicazione stia lasciando aperti gli handle di file. Prima di utilizzare lo script, configura le seguenti variabili: JAVA_HOME, QUICKSTART_PATH, OUTPUT_DIR, USER, MAX_FILES_THRESHOLD. Per utilizzare lo script, configuralo come cron job.
