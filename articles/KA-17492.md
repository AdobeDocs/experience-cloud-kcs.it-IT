---
title: Analisi dei problemi di indicizzazione di AEM
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:47:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/6/2022 9:04:25 AM
version-number: 1
article-number: KA-17492
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=846ba2fc-9632-ec11-b6e5-000d3a5ba97a
exl-id: 59a10140-0386-42f8-bd1a-a934a2276ca5
source-git-commit: 1c09d3c2f1f02c0a93586735779e91b9f40a7f7e
workflow-type: tm+mt
source-wordcount: '507'
ht-degree: 100%

---

# Analisi dei problemi di indicizzazione di AEM

## Descrizione


L’obiettivo di questo articolo è di fornire dettagli su come risolvere i problemi di indicizzazione più comuni.


## Risoluzione

<br><br>Analisi delle query lente<br><br><br><br> <br><br>
Vai su [!UICONTROL Strumenti] - [!UICONTROL Operazioni] - [!UICONTROL Dashboard] - [!UICONTROL Diagnosi] - [!UICONTROL Prestazioni delle query] per visualizzare l’elenco delle query lente.

Per informazioni dettagliate sull’analisi delle query lente, consulta [questo documento](https://experienceleague.adobe.com/docs/?lang=it#Troubleshooting%20indexing%20issues).

In ambienti non di produzione, è possibile installare il pacchetto di strumenti ACS AEM per disporre di uno strumento di query esplicativo per ulteriori operazioni di debug. <br><br><br><br> <br><br>Reindicizzazione degli indici asincroni<br><br><br><br><br><br>
Nota:

La reindicizzazione in genere non risolve i problemi relativi alle query, ad esempio le query che non restituiscono i risultati corretti. La reindicizzazione inoltre può richiedere molto tempo, per cui deve essere evitata a meno che non sia coperta da uno dei motivi elencati. <br><br><br><br> <br><br>
<b>Reindicizzare un indice asincrono</b>

- Accedi all’istanza AEM
- Apri `http://aemhost:port/crx/de/index.jsp`
- Passa alla definizione dell’indice in `/oak:index`
- Imposta una proprietà booleana `reindex=true` sull’indice da reindicizzare, quindi salva. All’avvio dell’indicizzazione viene visualizzato un messaggio di registro simile al seguente:

```
23.06.2015 14:26:23.070 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes: /oak:index/cqAcUUID, /oak:index/nodetype, /oak:index/deviceIdentificationMode, /oak:index/campaignpath, /oak:index/active, /oak:index/jcrFrozenMixinTypes
```

- Quando la reindicizzazione è in corso, l’attributo “`status`” di `IndexStatsMBean` ha il valore “`running`”.

```
 23.06.2015 14:26:23.517 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing Traversed #10000 /jcr:system/jcr:versionStorage/c8/5f...23.06.2015 14:28:51.999 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report    - /oak:index/counter\*(708)    - /oak:index/authorizables\*(159)    - /oak:index/cqPageLucene\*(1913)    - /oak:index/ntBaseLucene\*(444)    - /oak:index/cqTagLucene\*(512)    - /oak:index/workflowDataLucene\*(116)
```

- Puoi confermare che l’indicizzazione è stata completata verificando il nodo di definizione dell’indice, dove la proprietà `reindexCount` dovrebbe essere stata incrementata e la reindicizzazione booleana dovrebbe essere impostata su “`false`”

   Nel file di registro, se l’indicizzazione è stata completata correttamente, verrà visualizzata la voce seguente

```
23.06.2015 14:28:52.009 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Reindexing (async) completed for indexes: /oak:index/counter\*(708), /oak:index/authorizables\*(159), /oak:index/cqPageLucene\*(1913), /oak:index/ntBaseLucene\*(444), /oak:index/cqTagLucene\*(512), /oak:index/workflowDataLucene\*(116) in 30.36 s
```

- Se la reindicizzazione non è completa ed è entrata in un loop, vedi la [sezione seguente](https://helpx.adobe.com/experience-manager/kb/Analyzing-AEM-Indexing-Issues.html#Analyzing_Failed_Reindexing).


L’attività dell’indice asincrono può essere identificata a livello di INFO eseguendo il comando grep su `org.apache.jackrabbit.plugins.index.IndexUpdate` e `org.apache.jackrabbit.plugins.index.AsyncIndexUpdate`.
 <br><br>Problemi relativi alle prestazioni dell’indicizzazione asincrona<br><br><br><br> 
- Abilita la registrazione per convalidare la tempistica:


Livello di TRACCIA (solo in Oak 1.0.17 o versioni successive):

```
org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext.perf
```

Livello di DEBUG:

```
org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate

org.apache.jackrabbit.oak.plugins.index.IndexUpdate

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor

org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext

org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier
```

Questa operazione genera dei registri che mostrano i tempi di indicizzazione, in modo simile al seguente:

```
09.07.2015 08:13:38.401 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 Adding node /content/dam/site/test/jackrabbit-oak7.png
09.07.2015 08:13:38.583 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 save
09.07.2015 08:13:42.823 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Running background index task async
09.07.2015 08:13:42.963 \*TRACE\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor /oak:index/lucene Indexed document for /content/dam/site/test/jackrabbit-oak7.png/jcr:content/related is Documentstored,indexed,omitNorms,indexOptions=DOCS_ONLY:path:/content/dam/site/test/jackrabbit-oak7.png/jcr:content/related indexed,tokenized:fulltext:related
09.07.2015 08:13:43.579 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report
```

- `/oak:index/siteDamIndex(2)`
- `/oak:index/lucene(15)`

```
09.07.2015 08:13:43.779 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/siteDamIndex Index found to be updated. Reopening the IndexNode took 150ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier.perf /oak:index/lucene Copied 0 files totaling 0 B took 1465ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier /oak:index/lucene opening remote only file segments.gen
09.07.2015 08:13:45.361 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/lucene Index found to be updated. Reopening the IndexNode took 1581ms
```

- Acquisisci una serie di immagini thread e cerca il thread contenente `AsyncIndexUpdate` nello stack, in modo da stabilire come viene impiegato il tempo di indicizzazione o se l’indicizzazione è in attesa su altri thread. Per acquisire le immagini thread, consulta [questo articolo](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html).
- Imposta la proprietà booleana `saveDirectoryListing=true` (solo se utilizzi Oak 1.0.16, per le versioni successive non è necessario) e le proprietà `excludedPaths=/var`, `/etc/workflow/instances`, `/jcr:system` sull’indice OOTB `/oak:index/lucene` per ottimizzarlo.
- Fai clic su “Salva tutto”
- Quando crei indici personalizzati con proprietà Lucene, assicurati di impostare `saveDirectoryListing=true` (booleano) se utilizzi Oak 1.0.16 e di impostare `includedPaths` (stringa) per limitare l’indicizzazione solo a determinati percorsi.


Vai all’URL `/system/console/configMgr/org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexProviderService`“Copy on Read” (Copia su lettura), “Copy on Write” (Copia su scrittura) (utilizzabile solo in Oak 1.0.18 e versioni successive) e “Prefetch Index Files” (Prelettura dei file di indice) (solo in Oak 1.0.18 e versioni successive)
<br><br><br>Analisi della reindicizzazione non riuscita<br><br><br><br>
- Quando l’indicizzazione asincrona ha esito negativo e verifichi le statistiche dell’indicizzatore asincrono nell’interfaccia utente di JMX (collegamento qui sotto), puoi notare che `LastIndexedTime` presenta una data e un’ora precedenti:

```
http://localhost:4502/system/console/jmx/org.apache.jackrabbit.oak%3Aid%3D11%2Cname%3D"async"%2Ctype%3D"IndexStats"
```

- Inoltre, quando la reindicizzazione ha esito negativo, entra in un loop simile al seguente:

```
08.01.2015 01:22:04.474 \*INFO\* pool-9-thread-2 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 01:52:08.365 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 09:33:23.306 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified
```

- Se visualizzi questo codice, abilita la registrazione a livello di debug per `org.apache.jackrabbit.oak.plugins.index`


- Al successivo loop dell’indicizzazione con relativo messaggio di registro, verrà visualizzato anche un messaggio di registro di debug nella parte superiore con ulteriori dettagli sul motivo del fallimento dell’indicizzazione.  In questo modo puoi risolvere il problema, sia che si tratti di un nodo corrotto, di un BLOB mancante o di altro.
