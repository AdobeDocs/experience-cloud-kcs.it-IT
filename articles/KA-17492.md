---
title: Analisi dei problemi di indicizzazione AEM
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 5:47:49 PM
article-published-by: Cedric Latimier
article-published-date: 1/6/2022 9:04:25 AM
version-number: 1
article-number: KA-17492
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=846ba2fc-9632-ec11-b6e5-000d3a5ba97a
exl-id: 59a10140-0386-42f8-bd1a-a934a2276ca5
source-git-commit: 1c09d3c2f1f02c0a93586735779e91b9f40a7f7e
workflow-type: tm+mt
source-wordcount: '507'
ht-degree: 0%

---

# Analisi dei problemi di indicizzazione AEM

## Descrizione


L&#39;obiettivo di questo articolo è quello di avere dettagli su come risolvere tutti i problemi comuni di indicizzazione.


## Risoluzione

<br><br>Analisi delle query lente<br><br><br><br> <br><br>
Andando a [!UICONTROL Strumenti] - [!UICONTROL Operazioni] - [!UICONTROL Dashboard] - [!UICONTROL Diagnosi] - [!UICONTROL Prestazioni query] mostrerà l&#39;elenco delle query lente.

Vedi [presente documento](https://docs.adobe.com/docs/en/aem/6-2/deploy/platform/queries-and-indexing.html#Troubleshooting%20indexing%20issues) per informazioni dettagliate sull&#39;analisi delle query lente.

In ambienti non di produzione, è possibile installare il pacchetto strumenti ACS AEM per fornire uno strumento di spiegazione della query per ulteriori operazioni di debug.
<br><br><br><br> <br><br>Reindicizzazione degli indici asincroni<br><br><br><br><br><br>
Nota:

La reindicizzazione in genere non risolve i problemi di query, ad esempio le query che non restituiscono i risultati corretti. Inoltre, la reindicizzazione può richiedere molto tempo Reindicizzazione deve essere evitata a meno che non sia coperta da un motivo ivi elencato.
<br><br><br><br> <br><br>
<b>Come reindicizzare un indice asincrono</b>

- Accedi alla tua istanza AEM
- Open `http://aemhost:port/crx/de/index.jsp`
- Passa alla definizione dell&#39;indice in `/oak:index`
- Imposta una proprietà booleana `reindex=true` sull&#39;indice per reindicizzare, quindi salvare. All&#39;avvio dell&#39;indicizzazione vedrai un messaggio di log come questo:

```
23.06.2015 14:26:23.070 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes: /oak:index/cqAcUUID, /oak:index/nodetype, /oak:index/deviceIdentificationMode, /oak:index/campaignpath, /oak:index/active, /oak:index/jcrFrozenMixinTypes
```

- Durante la reindicizzazione è in corso il &quot;`status`&quot; attributo di `IndexStatsMBean` avrebbe un valore`running`&quot;.

```
 23.06.2015 14:26:23.517 \*INFO\* FelixStartLevel org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing Traversed #10000 /jcr:system/jcr:versionStorage/c8/5f...23.06.2015 14:28:51.999 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report    - /oak:index/counter\*(708)    - /oak:index/authorizables\*(159)    - /oak:index/cqPageLucene\*(1913)    - /oak:index/ntBaseLucene\*(444)    - /oak:index/cqTagLucene\*(512)    - /oak:index/workflowDataLucene\*(116)
```

- Puoi confermare che l&#39;indicizzazione è stata completata controllando il nodo di definizione dell&#39;indice, la proprietà `reindexCount` dovrebbe essere stato incrementato e la reindicizzazione booleana deve essere impostata su &quot;`false`&quot;

   Nel file di registro, se l’indicizzazione è stata completata correttamente, verrà visualizzata la seguente voce

```
23.06.2015 14:28:52.009 \*INFO\* pool-8-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Reindexing (async) completed for indexes: /oak:index/counter\*(708), /oak:index/authorizables\*(159), /oak:index/cqPageLucene\*(1913), /oak:index/ntBaseLucene\*(444), /oak:index/cqTagLucene\*(512), /oak:index/workflowDataLucene\*(116) in 30.36 s
```

- Se la reindicizzazione non è completa ed è passata in un ciclo, vedi [sezione sottostante](https://helpx.adobe.com/experience-manager/kb/Analyzing-AEM-Indexing-Issues.html#Analyzing_Failed_Reindexing).


L&#39;attività dell&#39;indice asincrono può essere identificata a livello di INFO raggruppando `org.apache.jackrabbit.plugins.index.IndexUpdate` e `org.apache.jackrabbit.plugins.index.AsyncIndexUpdate`.
 <br><br>Problemi di prestazioni dell&#39;indicizzazione asincrona<br><br><br><br> 
- Abilita la registrazione per convalidare la tempistica:


Livello TRACE (solo in Oak 1.0.17 o versione successiva):

```
org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext.perf
```

Livello DEBUG:

```
org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate

org.apache.jackrabbit.oak.plugins.index.IndexUpdate

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor

org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker

org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext

org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier
```

Registri come questo verrebbero generati mostrando i tempi di indicizzazione:

```
09.07.2015 08:13:38.401 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 Adding node /content/dam/site/test/jackrabbit-oak7.png
09.07.2015 08:13:38.583 \*TRACE\* 192.168.193.1 1436444018387 POST /content/dam/site/test.createasset.html HTTP/1.1 org.apache.jackrabbit.oak.jcr.operations.writes session-101777 save
09.07.2015 08:13:42.823 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate Running background index task async
09.07.2015 08:13:42.963 \*TRACE\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor /oak:index/lucene Indexed document for /content/dam/site/test/jackrabbit-oak7.png/jcr:content/related is Documentstored,indexed,omitNorms,indexOptions=DOCS_ONLY:path:/content/dam/site/test/jackrabbit-oak7.png/jcr:content/related indexed,tokenized:fulltext:related
09.07.2015 08:13:43.579 \*DEBUG\* pool-9-thread-1 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Indexing report
```

- `/oak:index/siteDamIndex(2)`
- `/oak:index/lucene(15)`

```
09.07.2015 08:13:43.779 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/siteDamIndex Index found to be updated. Reopening the IndexNode took 150ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier.perf /oak:index/lucene Copied 0 files totaling 0 B took 1465ms
09.07.2015 08:13:45.248 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexCopier /oak:index/lucene opening remote only file segments.gen
09.07.2015 08:13:45.361 \*TRACE\* oak-lucene-0 org.apache.jackrabbit.oak.plugins.index.lucene.IndexTracker.perf /oak:index/lucene Index found to be updated. Reopening the IndexNode took 1581ms
```

- Prendi una serie di immagini thread e cerca il thread contenente `AsyncIndexUpdate` nello stack per vedere dove viene trascorsa la maggior parte del tempo di indicizzazione o se l’indicizzazione è in attesa su altri thread. Per prendere i dump di thread vedi [articolo](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html).
- Imposta la proprietà booleana `saveDirectoryListing=true` (solo se utilizzi Oak 1.0.16, se non è necessaria una versione successiva) e imposta la proprietà `excludedPaths=/var`, `/etc/workflow/instances`, `/jcr:system` sulla `/oak:index/lucene` Indice OOTB per ottimizzarlo.
- Fai clic su &quot;Salva tutto&quot;
- Quando crei indici di proprietà lucene personalizzati, assicurati di impostare `saveDirectoryListing=true` (Booleano) se si utilizza Oak 1.0.16 e si imposta `includedPaths` (Stringa) per limitare l&#39;indice a indicizzare solo determinati percorsi.


Vai a questo URL `/system/console/configMgr/org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexProviderService` &quot;Copy on Read&quot;, &quot;Copy on Write&quot; (sicuro solo da utilizzare in Oak 1.0.18 e versioni successive) e &quot;Prefetch Index Files&quot; (solo in Oak 1.0.18 e versioni successive)
<br><br><br>Analisi della reindicizzazione non riuscita<br><br><br><br>
- Quando l&#39;indicizzazione asincrona non riesce, quando controlli le statistiche dell&#39;indicizzatore asincrono JMX UI (link qui sotto), vedrai che `LastIndexedTime` è una data e un’ora precedenti:

```
http://localhost:4502/system/console/jmx/org.apache.jackrabbit.oak%3Aid%3D11%2Cname%3D"async"%2Ctype%3D"IndexStats"
```

- Inoltre, quando la reindicizzazione non riesce, entra in un ciclo come questo:

```
08.01.2015 01:22:04.474 \*INFO\* pool-9-thread-2 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 01:52:08.365 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified08.01.2015 09:33:23.306 \*INFO\* pool-9-thread-5 org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed for following indexes /oak:index/damFileSize, /oak:index/lucene, /oak:index/cqLastModified
```

- Se vedi questo, abilita la registrazione a livello di debug per `org.apache.jackrabbit.oak.plugins.index`


- La prossima volta che l&#39;indicizzazione esegue il ciclo con il messaggio di log sopra un messaggio di log di debug sopra darebbe maggiori dettagli sul motivo per cui l&#39;indicizzazione non riesce.  Quindi puoi risolvere il problema, che si tratti di un nodo corrotto, un blob mancante o un altro problema.
