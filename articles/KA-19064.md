---
title: Come eseguire un controllo di coerenza del datastore tramite oak-run
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Akash Kapoor
article-created-date: 4/3/2022 9:37:38 PM
article-published-by: Akash Kapoor
article-published-date: 4/3/2022 9:39:46 PM
version-number: 2
article-number: KA-19064
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=68a58547-96b3-ec11-983f-000d3a5d09d6
exl-id: 8aec0830-a1db-4e57-95e4-3745e87bde32
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '392'
ht-degree: 0%

---

# Come eseguire un controllo di coerenza del datastore tramite oak-run

## Descrizione

Il controllo di coerenza dell&#39;archivio dati segnalerà tutti i file binari dell&#39;archivio dati mancanti ma a cui si fa ancora riferimento. Il controllo di coerenza può essere attivato direttamente dalla console Felix.<br>
Potrebbe essere attivata da MarkSweepGarbageCollector#checkConsistency Mbean

Se i MBeans BlobGC sono registrati in MBeanServer, è possibile utilizzare anche il seguente mbean:

BlobGCMbean#checkConsistency

Al termine del controllo di coerenza, un messaggio mostra il numero di binari segnalati come mancanti. Se il numero è maggiore di 0, controlla i registri configurati per org.apache.jackrabbit.oak.plugins.blob.MarkSweepGarbageCollector per ulteriori dettagli sui binari mancanti.

Di seguito è riportato un esempio di come i file binari mancanti vengono segnalati nei log:

`11:32:39.673 INFO main MarkSweepGarbageCollector.java:600 Consistency check found 1 missing blobs 11:32:39.673 WARN main MarkSweepGarbageCollector.java:602 Consistency check failure in the the blob store : DataStore backed BlobStore org.apache.jackrabbit.oak.plugins.blob.datastore.OakFileDataStore, check missing candidates in file /tmp/gcworkdir-1467352959243/gccand-1467352959243`

A differenza dell&#39;interfaccia utente /system/console/repositorycheck, lo strumento oak-run controlla i file di indice lucene nascosti sotto /oak: oltre al resto dei percorsi di contenuto. comando &quot;datastorecheck&quot; di <b>corsa di oak </b>può essere utilizzato per eseguire un controllo di coerenza sull’archivio dati.  I passaggi dettagliati su come eseguire il comando sono descritti di seguito:




## Risoluzione


1. Scarica la versione oak-run jar 1.8.8 o successiva sul tuo server AEM.
2. Posiziona il jar di esecuzione oak nella stessa directory in cui si trova crx-quickstart altrimenti fornisci il percorso completo di oak-run-\*.jar mentre esegui il comando sottostante.
3. Esegui il comando seguente (aggiorna i percorsi al segmentstore e al datastore in base al tuo ambiente):


`java -jar oak-run-*.jar datastorecheck --consistency --ref --id --fds crx-quickstart/install/org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.config --repoHome crx-quickstart/repository --store crx-quickstart/repository/segmentstore --dump temp --verbose --track`

4. Il comando genera un controllo di coerenza del datastore.

Il controllo di coerenza per il DataStore può anche essere utilizzato per elencare tutti i riferimenti blob nell&#39;archivio nodi e tutti gli ID blob disponibili nell&#39;archivio dati. Utilizzare il comando seguente:

`$ java-jar oak-run-*.jar datastorecheck --id --ref --consistency \`

`--store | \`

`--s3ds |--fds \`

`--dump \`

`--track`



Fornisci una o più delle seguenti opzioni disponibili:

—id - Elenca tutti gli ID nell&#39;archivio dati.

—ref - Elenca tutti i riferimenti blob nell&#39;archivio nodi.

—consistency - Elenca tutti i blob mancanti effettuando un controllo di coerenza.



Le seguenti opzioni sono facoltative:

—store - Percorso all&#39;archivio dei segmenti di mongo uri (richiesto per le opzioni —ref e —consistency di cui sopra).

—dump - Percorso in cui scaricare i file (facoltativo). In caso contrario, i file vengono scaricati nella directory tmp dell&#39;utente.

—s3ds - Percorso del file di configurazione S3DataStore.

—fds - Percorso del file di configurazione FileDataStore ( la proprietà &#39;path&#39; è obbligatoria).

—track - Percorso della cartella home dell&#39;archivio locale (facoltativo). Posiziona una copia degli ID BLOB scaricati da tracciare.
