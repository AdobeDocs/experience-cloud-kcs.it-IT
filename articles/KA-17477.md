---
title: "Spiegazione dei file di configurazione | AEM"
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: “KCS”
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "5/15/2023 7:12:42 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "5/15/2023 9:15:03 PM"
version-number: 3
article-number: KA-17477
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9533da75-54f3-ed11-8848-6045bd006149"
source-git-commit: 5849b91a727e32ea993724a7a374eae98aaa7ffa
workflow-type: tm+mt
source-wordcount: '1884'
ht-degree: 0%

---

# Spiegazione dei file di configurazione | AEM

## Descrizione {#description}

<b>Ambiente</b>
Experience Manager
<b>Problema/Sintomi</b>
In questo documento vengono suddivisi e illustrati ciascuno dei file di configurazione distribuiti in un server dispatcher standard fornito in Adobe Managed Services. Il loro utilizzo, la convenzione di denominazione, ecc.

<b>Convenzione di denominazione</b>

Apache Webserver in realtà non si preoccupa dell&#39;estensione di file quando esegue il targeting con un&#39;istruzione &quot;include&quot; o &quot;include&quot; opzionale. Denominarli correttamente con nomi che eliminano conflitti e confusione aiuta una tonnellata. I nomi utilizzati descrivono l’ambito di applicazione del file, facilitandone la vita. Se tutto si chiama .conf questo diventa molto confuso. Vogliamo evitare file ed estensioni con nomi non corretti.

Di seguito è riportato un elenco delle diverse estensioni di file personalizzate e convenzioni di denominazione utilizzate in un dispatcher configurato con AMS tipico.

<u>File contenuti in conf.d/</u>


| File | Destinazione file | Descrizione |
| --- | --- | --- |
| `<` NOME FILE`>` .conf | /etc/httpd/conf.d | Un&#39;installazione predefinita di Enterprise Linux utilizza questa estensione di file e include la cartella come luogo per sostituire le impostazioni in httpd.conf e consente di aggiungere funzionalità aggiuntive a livello globale in Apache. |
| `<` NOME FILE`>` .vhost | Staging: /etc/httpd/conf.d/available_vhosts/<br><br>Attivo:<br><br>/etc/httpd/conf.d/enabled_vhosts/<br><br><u style="box-sizing: border-box; border: 0 none">*Nota: I file .vhost non devono essere copiati nella cartella enabled_vhosts, ma usa collegamenti simbolici a un percorso relativo al file available_vhosts/ .vhost</u> | I file \*.vhost (Virtual Host) sono `<` VirtualHosts `>`  voci per far corrispondere i nomi host e consentire ad Apache di gestire il traffico di ogni dominio con regole diverse. Dal file .vhost verranno inclusi altri file come riscritture, whitelist, ecc. |
| `<` NOME FILE`>` _rewrite.rules | /etc/httpd/conf.d/rewrites/ | `*_rewrite.rules` archivio file `mod_rewrite` regole da includere e utilizzare esplicitamente in un file vhost |
| `<` NOME FILE`>` _whitelist.rules | /etc/httpd/conf.d/whitelists/ | I file \*_ipwhitelist.rules sono inclusi nei file \*.vhost. Contiene regex IP o consente regole di negazione per consentire l’inserimento di IP nella whitelist. Se tenti di limitare la visualizzazione di un host virtuale basato su indirizzi IP, genererai uno di questi file e includerlo dal file \*.vhost |


<u>File contenuti in conf.modules.d/</u>


| File | Destinazione file | Descrizione |
| --- | --- | --- |
| `<` NOME FILE`>` .any | /etc/httpd/conf.dispatcher.d/ | Il modulo Apache di AEM di Dispatcher viene originato dalle impostazioni dei file \*.any. Il file di inclusione padre predefinito è conf.dispatcher.d/dispatcher.any |
| `<` NOME FILE`>` _farm.any | Staging:<br><br>/etc/httpd/conf.dispatcher.d/available_farms/<br><br>Attivo:<br><br>/etc/httpd/conf.dispatcher.d/enabled_farms/<br><br><u style="box-sizing: border-box; border: 0 none">*Nota: questi file di farm non devono essere copiati nella cartella enabled_farms ma utilizzano collegamenti simbolici a un percorso relativo a available_farms/ _file farm.any</u>\*_ i file farm.any sono inclusi nel file conf.dispatcher.d/dispatcher.any . Questi file farm padre esistono per controllare il comportamento del modulo per ciascun rendering o tipo di sito web. I file vengono creati nella directory available_farms e attivati con un link simbolico nella directory enabled_farms.<br><br><br><br>Li include automaticamente per nome dal file dispatcher.any.<br><br><br><br>I file farm della linea di base iniziano con 000 _per assicurarti che siano caricati per primi.<br><br>I file farm personalizzati devono essere caricati dopo avviando lo schema del numero a 100_ per garantire il comportamento corretto di inclusione. |
| `<` NOME FILE`>` _filters.any | /etc/httpd/conf.dispatcher.d/filters/ | I file \*_filters.any sono inclusi nei file conf.dispatcher.d/enabled_farms/\*_farm.any. Ogni farm dispone di un set di regole che cambiano il traffico da filtrare e non da indirizzare ai render. |
| `<` NOME FILE`>` _vhosts.any | /etc/httpd/conf.dispatcher.d/vhosts/ | I file \*_vhosts.any sono inclusi nei file conf.dispatcher.d/enabled_farms/\*_farm.any. Questi file sono un elenco di nomi host o percorsi URI che devono essere confrontati con corrispondenze blob per determinare quale renderer utilizzare per elaborare la richiesta |
| `<` NOME FILE`>` _cache.any | /etc/httpd/conf.dispatcher.d/cache/ | I file \*_cache.any sono inclusi nei file conf.dispatcher.d/enabled_farms/\*_farm.any. Questi file specificano quali elementi sono memorizzati nella cache e quali no |
| `<` NOME FILE`>` _invalidate_allowed.any | /etc/httpd/conf.dispatcher.d/cache/ | I file \*_invalidate_allowed.any sono inclusi nei file conf.dispatcher.d/enabled_farms/\*_farm.any. Specificano quali indirizzi IP sono autorizzati a inviare richieste di scaricamento e di annullamento della validità. |
| `<` NOME FILE`>` _clientheaders.any | /etc/httpd/conf.dispatcher.d/clientheaders/ | I file \*_clientheaders.any sono inclusi nei file conf.dispatcher.d/enabled_farms/\*_farm.any. Specificano quali intestazioni client devono essere trasmesse a ogni renderer. |
| `<` NOME FILE`>` _renders.any | /etc/httpd/conf.dispatcher.d/renders/ | I file \*_renders.any sono inclusi nei file conf.dispatcher.d/enabled_farms/\*_farm.any. Specificano le impostazioni di IP, porta e timeout per ciascun renderer. Un modulo di rendering appropriato può essere un server livecycle o qualsiasi sistema AEM in cui il dispatcher può recuperare/proxy le richieste da |


<b>Problemi evitati</b>

Seguendo la convenzione di denominazione è possibile evitare alcuni errori abbastanza semplici da commettere che possono avere risultati catastrofici. Vi presenteremo alcuni esempi.

<u>Esempio di problema</u>

Come esempio del sito per ExampleCo, gli sviluppatori delle configurazioni del dispatcher hanno creato due file di configurazione.

`/etc/httpd/conf.d/exampleco.conf`


```
`<` VirtualHost *:80`>` 

    ServerName  "exampleco"

    ServerAlias "www.exampleco.com"

    .......... SNIP ...............

    `<` IfModule mod_rewrite.c`>` 

        ReWriteEngine   on

        LogLevel warn rewrite:trace1

        Include /etc/httpd/conf.d/rewrites/exampleco.conf

    `<` /IfModule`>` 

`<` /VirtualHost`>`
```


`/etc/httpd/conf.d/rewrites/exampleco.conf``>`


```
RewriteRule /$ /content/exampleco/en.html `[` PT,L`]` 

RewriteRule /robots.txt$ /content/dam/exampleco/robots.txt `[` PT,L`]`
```


<b>PERICOLO POTENZIALE</b>

<b>A. I nomi dei file sono gli stessi</b>

Se il file vhost viene accidentalmente inserito nella cartella di riscrittura e il file di riscrittura viene inserito nella cartella vhosts. Sembra essere distribuito correttamente dal nome del file, tuttavia Apache lancerà un errore e il problema non sarà immediatamente evidente.

<b>In che modo questo diventa un problema?</b>

Se i due file vengono scaricati nella stessa posizione, possono sovrascriversi o renderli indistinguibili rendendo il processo di distribuzione un incubo.

<b>B. Le estensioni dei file sono le stesse e rischiano l&#39;inclusione automatica</b>

Le estensioni dei file sono le stesse e utilizzano l&#39;estensione di inclusione automatica che Apache includerà automaticamente tutti i file .conf in molte delle cartelle predefinite.

<b>In che modo questo diventa un problema?</b>

Se il file vhost con estensione .conf viene messo nella cartella /etc/httpd/conf.d/, cercherà di caricarlo nella memoria su Apache, che in genere va bene, ma se il file delle regole di riscrittura con estensione .conf viene inserito nella `/etc/httpd/conf.d/` viene incluso automaticamente e applicato globalmente causando risultati confusi e indesiderati.


## Risoluzione {#resolution}


Denomina i file in base alle loro operazioni e in modo sicuro fuori dallo spazio dei nomi delle regole di inclusione automatica.

- Se si tratta di un file host virtuale, denominalo con `.vhost` come estensione.
- Se si tratta di un file di regola di riscrittura, denominalo con &quot;&lt;` site`>` _rewrite.rules` come suffisso ed estensione. Questa convenzione di denominazione chiarirà per quale sito si tratta e che si tratta di un insieme di regole di riscrittura.
- Se si tratta di un file di regola della whitelist IP, denominalo &quot;&lt;` description`>` _whitelist.rules` come suffisso ed estensione. Questa convenzione di denominazione fornisce una descrizione delle funzioni e di un set di regole di corrispondenza IP.


L&#39;utilizzo di queste convenzioni di denominazione evita problemi, se un file viene spostato in una directory di inclusione automatica che non appartiene.

Ad esempio, inserendo un file denominato con .rules, .any o .vhost nella cartella di inclusione automatica di `/etc/httpd/conf.d/` non avrebbe alcun effetto.

Se una richiesta di modifica della distribuzione riporta `please deploy exampleco_rewrite.rules to production dispatchers` la persona che distribuisce le modifiche può già sapere che non sta aggiungendo un nuovo sito; stanno solo aggiornando le regole di riscrittura come indicato dal nome del file.

<b>Ordine di inclusione</b>

Quando si estendono funzionalità e configurazioni in Apache Webserver installato su Enterprise Linux si ha alcune importanti importanti <b>includere ordini</b> vorrà capire.

A. La Linea Di Base Apache Include

![ordine di inclusione della linea di base Apache.  il binario apache inizia con httpd.conf che fa un &quot;include&quot; opzionale al conf.d/*.conf e conf.modules.d/* Directory .conf](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-Baseline-Includes.png "Apache-Webserver-Baseline-Includes")

Come mostrato nel diagramma sopra il binario httpd cerca solo il file httpd.conf come file di configurazione. Tale file contiene le seguenti istruzioni:


```
Include conf.modules.d/*.conf

IncludeOptional conf.d/*.conf
```


B. Comprende i livelli superiori AMS

Quando abbiamo applicato il nostro standard, abbiamo aggiunto alcuni tipi di file aggiuntivi e abbiamo aggiunto alcuni dei nostri.

Di seguito sono riportate le directory della linea di base AMS e gli include di livello superiore

![La linea di base AMS include inizia con un dispatcher_vhost.conf che includerà qualsiasi file con *.vhost dalla directory /etc/httpd/conf.d/enabled_vhosts/ .  Gli elementi nella directory /etc/httpd/conf.d/enabled_vhosts/ sono collegamenti simbolici al file di configurazione effettivo presente in /etc/httpd/conf.d/available_vhosts/](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS-Baseline-Includes.png "Apache-Webserver-AMS-Baseline-Includes")

Partendo dalla linea di base di Apache mostriamo come AMS ha creato alcune cartelle aggiuntive e include di livello superiore per `conf.d` cartelle e directory specifiche del modulo nidificate in `/etc/httpd/conf.dispatcher.d/`

Quando apache carica, effettua il pull in `/etc/httpd/conf.modules.d/02-dispatcher.conf` e quel file includerà il file binario `/etc/httpd/modules/mod_dispatcher.so` lo stato in cui è in esecuzione.


```
LoadModule dispatcher_module modules/mod_dispatcher.so
```


Per utilizzare il modulo nel nostro `<` VirtualHost /`>`  rilasciamo un file di configurazione in `/etc/httpd/conf.d/` denominato `dispatcher_vhost.conf` e all&#39;interno di questo file vedrai come impostare i parametri di base necessari per il funzionamento del modulo:


```
IfModule disp_apache2.c 

DispatcherConfig conf.dispatcher.d /dispatcher .any

...SNIP...

/IfModule
```


Come puoi vedere sopra, questo include il file di livello superiore dispatcher.any per il modulo dispatcher per raccogliere i file di configurazione da `/etc/httpd/conf.dispatcher.d/dispatcher.any`

Presta attenzione al contenuto di questo file:


```
/farms {

   $include "enabled_farms/*_farm.any"

}
```


Il file dispatcher.any di livello superiore include tutti i file farm abilitati presenti in `/etc/httpd/conf.dispatcher.d/enabled_farms/` con il nome file &quot;&lt;` FILENAME`>` _farm.any` conforme alla convenzione di denominazione standard.

Più tardi nella `dispatcher_vhost.conf` file menzionato in precedenza facciamo anche un&#39;istruzione include per abilitare ogni file host virtuale abilitato in `/etc/httpd/conf.d/enabled_vhosts/` con il nome del file &quot;&lt;` FILENAME`>` .vhost` conforme alla convenzione di denominazione standard.


```
IncludeOptional /etc/httpd/conf.d/enabled_vhosts/*.vhost
```


In ciascuno dei nostri file .vhost noterai che il modulo dispatcher viene inizializzato come gestore di file predefinito per una directory. Ecco un esempio di file .vhost per mostrare la sintassi:


```
`<` VirtualHost *:80`>` 

    ServerName    "weretail"

    ServerAlias www.weretail.com weretail.com

    `<` Directory /`>` 

        `<` IfModule disp_apache2.c`>` 

            ....SNIP....

            SetHandler dispatcher-handler

        `<` /IfModule`>` 

        ....SNIP....

    `<` /Directory`>` 

    ....SNIP....

`<` /VirtualHost`>`
```


Una volta che gli &quot;include di livello superiore&quot; risolvono, vale la pena citare altri &quot;sotto-include&quot;. Ecco un diagramma di alto livello su come i file farm e vhosts includono altri sottoelementi

C. L&#39;host virtuale AMS include

![Gli host virtuali ams includono elementi secondari.  Questa immagine mostra come un file .vhost include file da variabili, elenchi consentiti e cartelle di riscrittura](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS-Vhost-Includes.png "Apache-Webserver-AMS-Vhost-Includes")

Quando qualsiasi file .vhost da `/etc/httpd/conf.d/availabled_vhosts/` la directory viene collegata in modo simbolico `/etc/httpd/conf.d/enabled_vhosts/` verranno utilizzati nella configurazione in esecuzione.

I file .vhost dispongono di sottoinsiemi basati su parti comuni che abbiamo trovato.  Cose come variabili, whitelist e regole di riscrittura.

Il file .vhost avrà istruzioni di inclusione per ogni file in base a dove devono essere incluse nel file .vhost.  Ecco un esempio di sintassi di un file .vhost come buon riferimento:


```
Include /etc/httpd/conf .d /variables/weretail .vars VirtualHost *:80

ServerName    "${MAIN_DOMAIN}" 

Directory /          Include /etc/httpd/conf .d /whitelists/weretail *_whitelist.rules

IfModule disp_apache2.c

....SNIP....

SetHandler dispatcher-handler

/IfModule

....SNIP....

/Directory

....SNIP....

IfModule mod_rewrite.c

ReWriteEngine   on

LogLevel warn rewrite:trace1

Include /etc/httpd/conf .d /rewrites/weretail_rewrite .rules

/IfModule /VirtualHost
```


Come puoi vedere nell’esempio precedente c’è un include per le variabili necessarie in questo file di configurazione che vengono utilizzate in seguito.

All’interno del file `/etc/httpd/conf.d/variables/weretail.vars` possiamo vedere quali variabili sono definite:


```
Define MAIN_DOMAIN dev.weretail.com
```


È inoltre possibile visualizzare una riga che include un elenco di file whitelist.rules che limitano gli utenti che possono visualizzare il contenuto in base a diversi criteri di elenchi consentiti. Diamo un&#39;occhiata al contenuto di uno dei file della whitelist `/etc/httpd/conf.d/whitelists/weretail_mainoffice_whitelist.rules`:


```
`<` RequireAny`>` 

  Require ip 192.150.16.0/23

`<` /RequireAny`>`
```


Puoi anche visualizzare una riga che include un set di regole di riscrittura. Diamo un&#39;occhiata ai contenuti del `weretail_rewrite.rules` file:


```
RewriteRule /robots.txt$ /content/dam/weretail/robots.txt `[` NC,PT`]` 

RewriteCond %{SERVER_NAME} brand1.weretail.net `[` NC`]` 

RewriteRule /favicon.ico$ /content/dam/weretail/favicon.ico `[` NC,PT`]` 

RewriteCond %{SERVER_NAME} brand2.weretail.com `[` NC`]` 

RewriteRule /sitemap.xml$ /content/weretail/general/sitemap.xml `[` NC,PT`]` 

RewriteRule /logo.jpg$ /content/dam/weretail/general/logo.jpg `[` NC,PT`]`
```


D. L&#39;Azienda Agricola AMS Comprende

![<FILENAME>_farms.any includerà i file sub.any per completare una configurazione farm.  In questa immagine puoi vedere che una farm includerà ogni file di sezione di primo livello cache, intestazioni client, filtri, rendering e vhosts .any](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS-Farm-Includes.png "Apache-Webserver-AMS-Farm-Includes")

Quando uno qualsiasi &quot;&lt;` FILENAME`>` _farm.any` file da `/etc/httpd/conf.dispatcher.d/available_farms/` la directory viene collegata in modo simbolico `/etc/httpd/conf.dispatcher.d/enabled_farms/` verranno utilizzati nella configurazione in esecuzione.

I file di farm dispongono di sotto-elementi in base a [sezioni principali dell&#39;azienda](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=en#defining-farms-farms) come cache, intestazioni client, filtri, render e vhosts.

La ``<` FILENAME`>` _farm.any` files will have include statements for each file based on where they need to be included in the farm file. Here is an example syntax of a ``&lt;` FILENAME`>` _farm.any` file come buon riferimento:


```
/weretailfarm {  

    /clientheaders {

        $include "/etc/httpd/conf.dispatcher.d/clientheaders/ams_publish_clientheaders.any"

        $include "/etc/httpd/conf.dispatcher.d/clientheaders/ams_common_clientheaders.any"

    }

    /virtualhosts {

        $include "/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any"

    }

    /renders {

        $include "/etc/httpd/conf.dispatcher.d/renders/ams_publish_renders.any"

    }

    /filter {

        $include "/etc/httpd/conf.dispatcher.d/filters/ams_publish_filters.any"

        $include "/etc/httpd/conf.dispatcher.d/filters/weretail_search_filters.any"

    }

    ....SNIP....

    /cache {

        ....SNIP....

        /rules {

            $include "/etc/httpd/conf.dispatcher.d/cache/ams_publish_cache.any"

        }

        ....SNIP....

        /allowedClients {

            /0000 {

                /glob "*.*.*.*"

                /type "deny"

            }

            $include "/etc/httpd/conf.dispatcher.d/cache/ams_publish_invalidate_allowed.any"

        }

    ....SNIP....

    }

}
```


Come puoi vedere ogni sezione per la farm weretail invece di avere tutta la sintassi necessaria, utilizza invece un’istruzione &quot;include&quot;.

Diamo un&#39;occhiata alla sintassi di alcune di queste &quot;include&quot; per avere l&#39;idea di come apparirebbe ogni sottoinclusa `/etc/httpd/conf.dispatcher.d/vhosts/weretail_publish_vhosts.any`:


```
"brand1.weretail.com"

"brand2.weretail.com"

"www.weretail.comf"
```


Come puoi vedere, si tratta di un nuovo elenco separato da riga di nomi di dominio che deve eseguire il rendering da questa farm sugli altri.

Ora diamo un&#39;occhiata al `/etc/httpd/conf.dispatcher.d/filters/weretail_search_filters.any`:


```
/400 { /type "allow" /method "GET" /path "/bin/weretail/lists/*" /extension "json" }

/401 { /type "allow" /method "POST" /path "/bin/weretail/search/" /extension "html" }
```

