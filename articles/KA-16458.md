---
title: "Analisi dei dump dei thread di AEM"
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: "KCS"
resolution: Resolution
internal-notes: "Helpx Link: https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html"
bug: false
article-created-by: Emily Geary
article-created-date: "3/17/2021 9:11:03 PM"
article-published-by: Emily Geary
article-published-date: "3/17/2021 9:13:37 PM"
version-number: 2
article-number: KA-16458
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e70a8345-6587-eb11-a812-000d3a593216"
exl-id: 74bb70e4-a09b-48fc-8378-96a1736e5ebf
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1002'
ht-degree: 0%

---

# Analisi dei dump dei thread di AEM

## Descrizione


Analizzare AEM immagini di thread Java utilizzando [IBM Thread Analyzer](http://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c) strumento.


## Risoluzione


1. Scarica e installa [IBM Thread Analyzer](https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=2245aa39-fa5c-4475-b891-14c205f7333c) (lo chiameremo IBM TDA per farla breve)
2. Acquisizione [immagini di thread](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html) da un&#39;istanza AEM che presenta problemi di prestazioni.
3. Apri i dump di thread in IBM TDA.
4. Per visualizzare i dettagli di un dump di thread, seleziona il file nell&#39;elenco, quindi fai clic sul pulsante &quot;Dettaglio thread&quot;\*.

![dettaglio del thread](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1587732783/tda-threaddetail.png "dettaglio del thread")
5. Ordina per &quot;Profondità stack&quot; con stack più lunghi in alto.

![tda-image1](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image/tda-image1.png)
6. Esamina i thread con una profondità di stack di 10 o più righe.  Questi sono di solito i thread di maggior interesse.  Prendi appunti sui thread di interesse.
7. Ordina per thread &quot;State&quot; 8. Scorri verso il basso fino ai thread &quot;Eseguibili&quot;. I thread eseguibili sono quelli che impiegavano attivamente il tempo della CPU quando è stato effettuato il dump del thread.

*Nota: Quando rivedi i thread &quot;Eseguibili&quot;, puoi ignorare i thread elencati in [Thread che possono essere ignorati](https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html#ignorethreads) in fondo a questa pagina.*
9. Trova i thread eseguibili che fanno parte dell&#39;applicazione, ad esempio i thread di lavoro in background o i thread di richiesta (i thread di richiesta hanno nomi come questo *127.0.0.1 1347028187737 GET /content/sites/global/en/sitemap.static-delivery.httpd.html HTTP/1.1*). Una volta trovati, fai clic su di loro uno per uno.
10. Per ogni thread di richiesta, puoi scoprire quando il browser dell&#39;utente ha effettuato la richiesta al server guardando la marca temporale nel nome del thread.  Ad esempio, nel nome del thread sopra, la marca temporale (in formato millisecondo unix epoch) è 1347028187737.  Possiamo convertire quel numero di epoca in una data/ora utilizzando [www.epochconverter.com](http://www.epochconverter.com/).  Ogni dump di thread mostra la data e l&#39;ora in cui è stato effettuato.  Puoi prendere la differenza di tempo tra il tempo di richiesta e il tempo di dump del thread per vedere per quanto tempo una richiesta è stata attiva.
11. Dopo aver esaminato i thread di richiesta, scorri tra gli altri thread &quot;Eseguibili&quot;.  Una volta trovato un thread di interesse &quot;Eseguibile&quot;, guarda il pannello centrale, &quot;Thread in attesa&quot;.  I thread elencati sono in attesa che il thread selezionato rilasci un monitor.  Se non vedi alcun thread in attesa, allora il thread selezionato potrebbe essere ancora proprietario di un [Blocca](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html) (vedere implementazione delle classi di [Blocca](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/Lock.html) per ulteriori informazioni). Ad esempio, con un [BloccoLetturaScritturaRientrante](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html) non è possibile sapere quale thread è il lock holder, in quanto i lock implementano più monitor internamente.  Quindi potrebbe essere necessario guardare il codice sorgente per abbinarlo ad un thread che potrebbe essere il lock holder.
12. Se il thread aveva un blocco o un monitor che molti altri thread aspettavano allora passare attraverso il resto dei dump di thread per vedere se è possibile trovare altri thread che hanno lo stesso problema.  Vedi se lo stesso thread esiste ancora negli altri dump (in IBM TDA puoi selezionare più dump di thread e fare clic sul pulsante &quot;Confronta thread&quot;\* per visualizzare lo stato di un thread in più dump di thread.

![tda-comparethreads](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1159496390/tda-comparethreads.png)
13. Vedi il Servizio di raccolta nella schermata seguente:

![tda-Image2](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1730877898/tda-Image2.png)
14. In questa visualizzazione puoi vedere il thread attraverso più immagini di thread per vedere se si tratta di un thread in esecuzione lunga.  Fondamentalmente se il thread è in stato Eseguibile attraverso più dump e ha uno stack lungo, ciò solitamente significa che si tratta di un thread in esecuzione lunga.
15. Se non hai trovato molto guardando i thread eseguibili, torna all&#39;elenco dei thread, seleziona un dump di thread e fai clic sul pulsante &quot;Dettaglio monitor&quot;\* sul pannello superiore. IBM TDA aprirà una finestra che mostra una vista ad albero dei thread proprietari del monitor e dei relativi thread in attesa. Nota: Potrebbe visualizzare alcuni thread del pool di thread come il monitor del pool di thread del motore servlet, i thread inattivi potrebbero essere ignorati.  Di solito si può dire che un thread è un thread inattivo del pool perché la maggior parte delle volte hanno solo 10 linee di stack o meno.

![tda-monitordetail](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/thread-dump-analysis/_jcr_content/main-pars/image_1106466084/tda-monitordetail.png)




<b>Utilizzo della CPU a livello di thread (solo piattaforma Linux):</b>

1. Se hai catturato l&#39;output &quot;top -H -b -n1 -p javapid&quot; oltre ai dump di thread, puoi fare riferimento incrociato all&#39;utilizzo della CPU a livello di thread.  Apri l&#39;output superiore e ottieni l&#39;id di processo dei thread che utilizzano la CPU.  Converti l&#39;id del processo in esadecimale, quindi cerca quel valore esadecimale nel file di dump del thread corrispondente.  L’id deve corrispondere al &quot;nid&quot; di uno dei thread.
2. Se il thread corrispondente che utilizza la maggior parte della CPU è il &quot;Thread VM&quot; o qualsiasi thread &quot;GC&quot;, allora si potrebbe avere un problema di memoria.  Ripeti lo stesso esercizio per più dump di thread e output superiore e se c&#39;è un pattern di questi thread che richiede tempo alla CPU, hai un problema di memoria.
3. Se hai confermato il problema di memoria, acquisisci un’immagine heap la prossima volta che si verifica il problema.  Vedi [articolo](https://helpx.adobe.com/experience-manager/kb/AnalyzeMemoryProblems.html) per ulteriori informazioni sull’acquisizione e l’analisi delle immagini heap.


![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)![](https://helpx.adobe.com/libs/cq/ui/resources/0.gif)

Thread che possono essere ignorati:

- Thread VM: Questo è un thread di sistema VM.
- Thread che iniziano con thread di attività GC: Questi sono thread di raccolta degli oggetti inattivi.
- Thread con nomi simili a - 1347028691218 nel codice da java.net.PlainSocketImpl.socketAccept(Native Method): Questi sono thread dal pool di thread del motore servlet in attesa di nuove connessioni.
