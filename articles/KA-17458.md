---
title: Ottimizzazione della cache del Dispatcher
description: Descrizione
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/20/2021 7:12:29 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 1:45:44 PM
version-number: 1
article-number: KA-17458
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ee6e74a7-d931-ec11-b6e5-000d3a5ba97a
exl-id: 84871fce-d53d-4a1d-aabf-ccf8c8c47810
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '1477'
ht-degree: 1%

---

# Ottimizzazione della cache del Dispatcher

## Descrizione


Questo articolo si concentra sulle ultime ottimizzazioni nel dispatcher di AEM e su come sfruttarle al meglio.  Il dispatcher AEM è una memorizzazione in cache [proxy inverso](https://stackoverflow.com/questions/224664/difference-between-proxy-server-and-reverse-proxy-server) server progettato per l’utilizzo con Adobe Experience Manager.  Può essere installato ed eseguito come modulo all&#39;interno del software del server web esistente.  Al momento della stesura di questo articolo, il [modulo dispatcher supportato](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-install.html) su Apache HTTP Server, Microsoft IIS e iPlanet.


## Risoluzione

<br><br>Come funziona la memorizzazione in cache del dispatcher<br><br><br><br><br><br>
Al livello più semplice, il dispatcher AEM è un proxy inverso che funziona eseguendo la memorizzazione in cache, lo scaricamento della cache e l’invalidazione della cache.

Vedi i collegamenti correlati per maggiori dettagli sul dispatcher:

1. [Come funziona il dispatcher e come installarlo](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher.html).
2. [Opzioni di configurazione disponibili nel dispatcher](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html).
3. [Webinar sul funzionamento del dispatcher](https://github.com/cqsupport/webinar-dispatchercache) - tieni presente che alcune informazioni nella presentazione si basano su vecchie versioni del dispatcher.
4. [Sessione webinar Gems sulle caratteristiche del dispatcher, l&#39;utilizzo della CDN e la sicurezza](https://docs.adobe.com/ddc/en/gems/dispatcher-caching---new-features-and-optimizations.html).
5. [Sessione Gems sulle nuove funzionalità nel dispatcher (dopo la versione 4.1.9)](https://helpx.adobe.com/experience-manager/kt/eseminars/gems/aem-dispatcher.html).

<br><br><br><br><br><br>Ottimizzazione della cache del Dispatcher<br><br><br><br><br><br>
Di seguito sono riportati alcuni modi per ottimizzare la cache del dispatcher:

1. <b>Memorizza quasi tutto</b> - questo significa memorizzare nella cache qualsiasi contenuto che verrebbe richiesto più di una volta dagli utenti.
2. <b>Memorizza in cache contenuti personalizzati per diversi periodi di tempo</b> - Se il sito dispone di contenuti personalizzati, considera l&#39;utilizzo di [Apache Sling Dynamic Includes](https://helpx.adobe.com/experience-manager/kt/platform-repository/using/sling-dynamic-include-technical-video-setup.html) nell&#39;applicazione AEM per sfruttare Ajax (chiamate Asincrone JavaScript e XML a livello di browser), SSI (Server Side Includes a livello di Web Server) ed ESI (Edge-side Includes a livello di CDN) per memorizzare nella cache diverse parti della pagina per diversi periodi di tempo.
3. <b>Non eliminare mai la cache del dispatcher su un dispatcher live</b> - Se un dispatcher sta servendo contenuti live ed elimini la cache, questo causerà un massiccio flusso di richieste per tornare a AEM.  Per questo motivo, la cache del dispatcher non deve mai essere eliminata su un dispatcher live.
4. <b>Preparare la cache </b>- Prima di eliminare la cache del dispatcher, estrai il dispatcher dal load balancer, elimina la cache, quindi esegui uno strumento web crawler per memorizzare in cache i file sul dispatcher prima di metterlo sul load balancer.
5. <b>Pagine degli errori della cache</b> - Sfruttare <b>[DispatcherPassError 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-install.html#ApacheWebServer) </b>Direttiva (specifica di Apache Web Server) per distribuire pagine di errore come 404s dalla cache del dispatcher.
6. <b>Comprimi tutti i tipi di file eccetto quelli pre-compressi </b>- In Apache Web Server, [mod_deflate](https://httpd.apache.org/docs/2.4/mod/mod_deflate.html) potrebbe essere utilizzato, ma assicurati che <b>Varia: Agente utente </b>header<b> </b>non è impostato.  In Microsoft IIS, utilizza [Compressione dinamica](https://docs.microsoft.com/en-us/iis/configuration/system.webserver/httpcompression/).

   Esempio di configurazione Apache (specificando solo alcuni tipi di contenuto per evitare tipi di file precompressi):

   AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript
7. <b>Abilita [/serveStaleOnError](https://helpx.adobe.com/experience-manager/kb/ServeStaleContentOnError.html)</b> nella configurazione /cache - serve il vecchio file di cache quando AEM istanze servono gli errori.
8. <b>Aggiungi [/gracePeriod](https://docs.adobe.com/content/help/en/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html#configuring-the-dispatcher-cache-cache)</b> alla configurazione /cache - definisci il numero di secondi in cui una risorsa obsoleta e auto-invalidata può ancora essere servita dalla cache dopo l’ultimo evento di pubblicazione del contenuto (&quot;attivazione&quot;).  Questo riduce il numero di richieste che ritornano alle istanze di pubblicazione durante un’attività di pubblicazione di contenuti di grandi dimensioni, come ad esempio &quot;Attivazione ad albero&quot;.
9. <b>Aggiungi regole a [/ignoreUrlParams](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#IgnoringURLParameters)</b> - ignora i parametri querystring che non sono richiesti o utilizzati dall&#39;applicazione.  Questo consente di memorizzare in cache gli URL anche quando è presente una stringa di query.
10. <b>Memorizza in cache le intestazioni di risposta Cache-Control e Last-Modified</b> - Utilizzare<b> [/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders)</b> configurazione per memorizzare in cache le intestazioni di risposta HTTP <b>Controllo cache</b> e <b>Ultima modifica </b>e/o <b>ETag</b> intestazione se la stai inviando da AEM).  Questo aiuta a semplificare e ottimizzare la memorizzazione in cache a livello di CDN e browser.  La memorizzazione in cache di queste intestazioni lo rende così solo AEM imposta le intestazioni, non il server web stesso.  Tieni presente che quando lo fai, devi iniziare a inviare le intestazioni dall&#39;applicazione AEM.
11. <b>Memorizza in cache il più a lungo possibile</b> e <b>ridurre le richieste a cui si torna in AEM</b> - Ottimizzare le richieste di scaricamento abilitando [recupero](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#refetching-flush) scaricare tutti gli agenti di scarico.  O utilizzare [<b>/enableTTL</b>](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) e impostare <b>Controllo cache: max-age=..</b> intestazione per memorizzare in cache i file il più a lungo possibile.  Vedi [di seguito](https://helpx.adobe.com/experience-manager/kb/optimizing-the-dispatcher-cache.html#use-ttls) per informazioni dettagliate su questo argomento.

<br><br><br><br><br><br>Utilizzo dei TTL<br><br><br><br><br><br>
Dalla versione 4.1.11 di Dispatcher, [/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL) può essere impostato nella configurazione del file .any.  Questa impostazione fa sì che il dispatcher rispetti le scadenze della cache impostate nell&#39;intestazione di risposta HTTP Cache-Control.  In altre parole, il dispatcher funzionerà in modo simile a una CDN in cui la forma principale di invalidazione della cache si verifica quando i file scadono.  Una volta implementata questa e inizia a inviare <b>Controllo cache: max-age=.. </b>per tutte le risposte da AEM, puoi tranquillamente disabilitare gli agenti di flush del dispatcher nelle istanze di pubblicazione.

Dopo aver disabilitato gli agenti di flush sulle istanze di pubblicazione, potresti comunque voler essere in grado di svuotare la cache del dispatcher.  In tal caso, puoi utilizzare [ACS Commons - Interfaccia flush del dispatcher](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html).  Questo strumento è installato sull&#39;istanza dell&#39;autore.  Offre agli utenti un’interfaccia utente in cui possono eseguire richieste di scaricamento manuale della cache.

<b>I. Passaggi per abilitare gli invalidamenti dello stile TTL (&quot;Time to Live&quot; o di scadenza):</b>

1. Modificare il codice sorgente nell&#39;applicazione AEM da inviare <b>Controllo cache </b>intestazione e <b>Ultima modifica </b>per tutte le richieste in cui non è già impostato.
2. Installa Dispatcher 4.1.11 o successivo.
3. Imposta <b>[/enableTTL 1](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#ConfiguringTimeBasedCacheInvalidationenableTTL)</b> nella configurazione .any farm del sito.
4. Imposta la <b>[/headers](https://helpx.adobe.com/experience-manager/dispatcher/using/dispatcher-configuration.html#CachingHTTPResponseHeaders) </b>configurazione per memorizzare nella cache <b>Controllo cache</b> e <b>Ultima modifica</b> intestazioni.
5. Riavvia il server web.


<b>II. Disattiva gli agenti flush del dispatcher sulle istanze di pubblicazione:</b>

Il dispatcher utilizzerà ora l&#39;intestazione Cache-Control per controllare l&#39;invalidazione dei file di cache.  In questo caso, non è più necessario eseguire il flush del dispatcher dalle istanze di pubblicazione.

1. Vai a /etc/replication/agents.publish.html su ogni istanza di pubblicazione.
2. Vai alla configurazione di ogni agente di flush e disabilita l&#39;agente.


<b>III. Consenti richieste di flush del dispatcher manuale dall&#39;istanza dell&#39;autore:</b>

Ora che gli agenti di pulizia sono disabilitati, ci si può basare interamente su <b>Controllo cache </b>intestazione per controllare quando il contenuto viene aggiornato sul dispatcher.  Puoi ancora consentire agli utenti di eseguire scaricamenti manuali della cache del dispatcher:

1. Installa [ACS Commons - Interfaccia flush del dispatcher](https://adobe-consulting-services.github.io/acs-aem-commons/features/dispatcher-flush-ui/index.html) sull’istanza dell’autore.
2. Configura gli agenti di flush sull&#39;istanza dell&#39;autore.
3. In ciascuna delle configurazioni dell&#39;agente, imposta <b>Triggers</b> = <b>Ignora impostazioni predefinite </b>opzione attivata. Questa opzione fa ignorare gli agenti di flush quando gli utenti fanno clic su <b>(Annulla)Pubblica </b>o <b>(De)Attiva</b> nell’interfaccia AEM.

<br><br><br><br><br><br>Recupero del flush del dispatcher<br><br><br><br><br><br>
Per ottimizzare le richieste di flush del dispatcher, tutti gli agenti di flush del dispatcher devono avere una funzione chiamata refetching flush abilitata.

Per abilitare il recupero dello scaricamento del dispatcher, procedi come segue:

1. Vai a <b>*http://aemhost:port*/crx/packmgr/index.jsp</b> e accedi come amministratore.
2. Scarica il pacchetto da [qui](https://github.com/cqsupport/webinar-dispatchercache/blob/master/packages/dispatcher-flush-refetch-samplecode-1.0.zip?raw=true).
3. Carica e installa il pacchetto nel gestore dei pacchetti.
4. Vai alla configurazione dell’agente di flush del dispatcher. Esempio <b>/etc/replication/agents.author/flush.html</b>
5. Fai clic su <b>Modifica</b>
6. Imposta quanto segue
   - <b>Tipo di serializzazione</b> = <b>Recupero nuovo scaricamento del Dispatcher</b>
   - <b>Esteso</b> = <b>metodo HTTP</b> = <b>POST</b>
7. Fai clic su <b>Salva</b>


Il pacchetto installato sopra è solo un esempio di base.  Per personalizzare e ottimizzare il flush di recupero, è possibile modificare l’elenco degli URI che invia.  Il codice è open source e può essere trovato [qui](https://github.com/cqsupport/webinar-dispatchercache/tree/master/src/refetching-flush-agent/refetch-bundle).  Il codice aggiunge un elenco di URI al corpo della richiesta come parametri che indicano al dispatcher quali percorsi recuperare.  Puoi aggiungere più percorsi in base ai requisiti delle applicazioni per ottimizzare le funzionalità di memorizzazione in cache del sito.
<br><br><br><br><br><br>Una spiegazione più dettagliata del recupero del flush<br><br><br><br><br><br>
Normalmente lo scaricamento di un dispatcher funziona eliminando i file:

1. File Touch .stat
2. Elimina /content/foo.\*
3. Elimina /content/foo/_jcr_content


A causa del fatto che i file vengono eliminati nel passaggio 2, la prossima volta che un utente richiede un file come /content/foo.html o /content/foo.json, mentre il file viene &quot;ri-recuperato&quot;, le richieste successive per lo stesso file verranno inviate anche alle istanze di pubblicazione fino a quando il file non viene memorizzato nella cache.  Per risposte lente o pagine con traffico intenso come le home page, questo può causare un allagamento del livello di istanza di pubblicazione.

Per risolvere questo problema, abilita una funzione del dispatcher denominata re-fetching.  Questa funzione ti consente di inviare un elenco di URI che il dispatcher dovrebbe &quot;recuperare&quot; in modo proattivo e sostituire invece di eliminare.

Vedere 22:41-27:05 in questo [registrazione di presentazioni](https://my.adobeconnect.com/p7th2gf8k43) per una dimostrazione di come funziona e come configurarlo.
