---
title: Analisi del protocollo SMPP tramite [!DNL Wireshark]
description: Descrizione
solution: Campaign
product: Campaign
applies-to: Campaign Classic
keywords: KCS, SMPP, Wireshark
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Craig Thonis
article-created-date: 5/6/2022 3:51:03 PM
article-published-by: Craig Thonis
article-published-date: 5/6/2022 3:52:19 PM
version-number: 4
article-number: KA-17506
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=9319e64e-54cd-ec11-a7b5-6045bd00d4f5
exl-id: 39c89da2-36ae-4c66-9553-cfc3d5b4003a
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '2415'
ht-degree: 1%

---

# Analisi del protocollo SMPP tramite [!DNL Wireshark]

## Descrizione

<br>Scopri come analizzare il traffico SMPP utilizzando [!DNL Wireshark].<br><br><br><br><br>Introduzione<br><br><br><br> <br><br>
La maggior parte degli SMS-C ad alta velocità sono compatibili con il protocollo SMPP versione 3.4. Questo protocollo consente l’invio di SMS e la ricezione di informazioni sulla consegna di questi SMS. Il protocollo SMPP è documentato nella specifica del protocollo SMPP v3.4 disponibile su Internet come documento PDF.

Questo articolo non sostituisce questa specifica: fornisce suggerimenti pratici su come interpretare la specifica del protocollo e come farlo corrispondere alla [!DNL Wireshark] per facilitare la risoluzione dei problemi tra Adobe Campaign e il partner SMS-C.

Poiché il protocollo SMPP contiene molte parti diverse rimaste all&#39;interpretazione del team di implementazione, ci sono differenze tra diversi SMS-C.

Quando si risolvono i problemi, contatta sempre il partner SMS-C per ottenere informazioni o per aiutarti a controllare due volte ciò che ottieni. Se l’SMS-C risponde con un errore, il tuo partner SMS-C sarà la persona migliore per dirti perché ha risposto con l’errore. Se utilizzi un simulatore SMPP invece di connetterti a un SMS-C reale, devi utilizzare il codice sorgente (o un debugger) per capire cosa sta succedendo.


## Risoluzione

<br><br>Acquisizione del traffico di rete senza [!DNL Wireshark]<br><br><br><br><br><br>
Se non si dispone di accesso diretto alla macchina, potrebbe essere necessario acquisire utilizzando strumenti della riga di comando come *tcpdump*. Se si conosce già la porta TCP della connessione, inserire il filtro corretto per evitare di catturare tutto il traffico. Esempio `tcpdump` riga di comando per la porta di acquisizione `12345` a <b>`outfile.pcap`</b>:


| `tcpdump -i any -w outfile.pcap tcp port 12345` |
| --- |


Il file <b>`outfile.pcap`</b> può quindi essere aperto in [!DNL Wireshark] per ulteriori analisi.


<br><br>[!DNL Wireshark] movimentazione<br><br><br><br> <br><br><br><br>
Questo argomento presuppone che tu abbia familiarità con le nozioni di base di [!DNL Wireshark]: acquisizione di pacchetti, definizione di filtri semplici, lettura dei dettagli dei pacchetti. Una breve introduzione è disponibile su [howtogeek - Come utilizzare [!DNL Wireshark] acquisizione, filtro e pacchetti Inspect](https://www.howtogeek.com/104278/how-to-use-wireshark-to-capture-filter-and-inspect-packets/).

Per filtrare il traffico SMPP in [!DNL Wireshark], sono disponibili tre funzioni importanti:

- Utilizza un filtro di visualizzazione sulla porta dell’SMS-C. Ad esempio, se l’SMS-C utilizza la porta `10000`, utilizza il seguente filtro:
   *`tcp.port == 10000`*


Per isolare i pacchetti in base al numero di telefono o al contenuto di testo, utilizzare la funzione di ricerca con le seguenti impostazioni:
![smpp1](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image/smpp1.png "smpp1")
- Utilizza la <b>Segui flusso TCP</b> strumento per isolare il flusso su cui stai lavorando.
Chiude la finestra di testo rosso/blu che si apre perché è utile solo per i protocolli di testo che non sono rilevanti per SMPP.
   ![smpp2](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_964579199/smpp2.png "smpp2")



<br><br><br><br>Protocollo SMPP<br><br> <br><br>
Il protocollo funziona su TCP ed è completamente binario, il che significa che strumenti speciali come [!DNL Wireshark] (o un editor esadecimale) sono necessari per decrittografare il contenuto del flusso.

Il flusso è costituito da PDU indipendenti: ogni PDU è un messaggio contenente un comando, uno stato, un numero di sequenza e altre informazioni basate sul comando.

A causa della natura di TCP come protocollo di flusso, un pacchetto TCP può contenere più di una PDU e le PDU possono estendersi su due o più pacchetti TCP. [!DNL Wireshark] riassemblerà correttamente le PDU, in modo che sia principalmente trasparente per [!DNL Wireshark] utente.

Ecco un esempio di PDU che passano attraverso la rete quando si invia un MT e poi si riceve un SR:
![smp3](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_388497282/smpp3.png "smp3")
Nota:

L’elenco dei comandi standard si trova nella sezione 5.1.2.1 della specifica SMPP (SMPP Command set).
<br><br><br><br><br><br>Risposte SMPP<br><br><br><br> <br><br>
Il protocollo SMPP richiede che tutti i comandi siano riconosciuti da una PDU di risposta:

`BIND_TRANSMITTER` è riconosciuto da *`BIND_TRANSMITTER_RESP`*, *`SUBMIT_SM`* è riconosciuto da *`SUBMIT_SM_RESP`*, ecc.

Il timeout per le risposte è in genere di 10, 30 o 60 secondi. La risposta può contenere una conferma positiva (`command _status = 0`) o un errore (vedi 5.1.3 *`command_status`*, *tabella 5-2* nella specifica SMPP per l&#39;elenco degli errori standard). Nella maggior parte dei casi, queste risposte sono immediate e non viene raggiunto un timeout di risposta.

Assicurati di distinguere tra gli errori di risposta SMPP e i codici di errore SR: lo stesso codice di errore può indicare elementi diversi nell’errore di risposta o nel campo di errore SR. Quando segnali un codice di errore, devi fare molta attenzione a dove lo trovi, perché il significato del valore dipende dal suo contesto.
<br><br><br><br><br><br>Inizializzazione della connessione SMPP<br><br><br><br><br><br>
La connessione SMPP viene avviata tramite la connessione TCP. Poi un `BIND` l&#39;operazione viene inviata da [!DNL Campaign], riconosciuto da un `BIND RESP`. Tali operazioni sono descritte nella sezione 4.1 della specifica SMPP (`BIND` funzionamento).
![smpp4](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_468626174/smpp4.png "smpp4")
L’operazione di binding esegue il controllo di accesso/password e scambia informazioni sul nome della piattaforma, sulla versione e su altri campi descritti nella specifica.

Nota:

L’accesso è disponibile nella `system_id` campo .



In [!DNL Campaign], dovrebbe essere visualizzata una *`BIND_TRANSMITTER`* pacchetto quando si avvia un trasferimento MT e un *`BIND_RECEIVER`* packet quando *`nlsm s`* attiva una connessione MO/SR.

<b>Trasmettitore, ricevitore e ricetrasmettitore: </b>Il connettore SMPP per Campaign Classic funziona in modalità trasmettitore/ricevitore separata: ci sono due connessioni TCP, una per la trasmissione MT e un&#39;altra per la ricezione di MO e SR. La connessione TCP viene sempre avviata da [!DNL Campaign], anche per la modalità ricevitore.

SMPP fornisce anche una modalità transceiver, ma questa modalità non è implementata nel connettore SMPP per Campaign Classic.

Il connettore SMPP utilizza più connessioni in parallelo per trasmettere MT. Questo non può essere controllato a causa del modo in cui è progettato il connettore.
<br><br><br><br><br><br>MO ricevente<br><br><br><br><br><br>
Quando il destinatario è vincolato, l’SMS-C può inviare MO in qualsiasi momento. Il MO viene inviato utilizzando un *`DELIVER_SM`* PDU con bit 2-5 di *`esm_clas s`* chiaro (spesso, *`esm_class`* sarà semplicemente 0).
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_695769115/smpp5.png "smpp5")
La *`DELIVER_SM`* La PDU deve ricevere una risposta rapida da un *`DELIVER_SM_RESP`* PDU con lo stesso *`sequence_number`*.
<br><br><br><br><br><br>Invio MT<br><br><br><br><br><br>
Per inviare un MT, il trasmettitore deve essere collegato con successo. Prima di tutto, verificare che il processo di binding sia stato eseguito correttamente.

Il MT viene inviato in un *`SUBMIT_SM`* PDU L&#39;SMS-C dovrebbe rispondere rapidamente con un *`SUBMIT_SM_RESP`* PDU: questo pacchetto di risposta è speciale perché contiene l&#39;ID del messaggio nel database dell&#39;SMS-C (includi sempre questo ID quando parli con il partner SMS-C per aiutarlo a trovare il messaggio più rapidamente). Questo ID sarà presente nell&#39;SR ed è l&#39;unico modo per abbinare l&#39;MT all&#39;SR corrispondente.

Il campo *`registered_delivery`* (descritto al punto 5.2.17 del disciplinare) indica all’SMS-C se è richiesta una SR per questo particolare MT. Se non ricevi SR per un messaggio specifico, controlla che il campo sia impostato correttamente nel *`SUBMIT_SM`* PDU
![smpp5](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1891077095/smpp5.png "smpp5")<br><br><br><br><br><br>Codifica di MT<br><br><br><br><br><br>
Attenzione:

La codifica SMS è un argomento complesso con molte trappole e diverse implementazioni.


<br><br><br><br> <br><br>
È buona prassi contattare sempre il partner SMS-C in caso di problemi di codifica. Il tuo partner SMS dispone di una conoscenza precisa della codifica supportata e delle regole speciali che possono essere applicate a causa di limitazioni nella sua piattaforma tecnica. Fateli controllare ciò che inviate loro e ciò che vi inviano, è l&#39;unico percorso per un&#39;interconnessione stabile e di successo.

I messaggi SMS utilizzano una speciale codifica a 7 bit, spesso denominata codifica GSM7. Fai riferimento a [!DNL Wikipedia] GSM 03.38 (in inglese).
<br><br><br><br> <br><br>
Nel protocollo SMPP, il testo GSM7 verrà espanso a 8 bit per carattere per facilitare la risoluzione dei problemi. L’SMS-C lo impacchetterà in 7 bit per carattere prima che venga inviato al dispositivo mobile. Ciò significa che il campo short_message dell’SMS può avere una lunghezza massima di 160 byte nel frame SMPP, mentre è limitato a 140 byte quando viene inviato sulla rete mobile (il bit più significativo viene semplicemente scartato).

In caso di problemi di codifica, ecco alcuni aspetti importanti da verificare:

- In primo luogo, assicurati di sapere quali caratteri appartengono a quale codifica. GSM7 è infame per il suo parziale sostegno dei segni diacritici (accenti). Specialmente in francese, dove é ed è fanno parte del GSM7, ma ê, o ï no. La situazione non è migliore per quanto riguarda lo spagnolo.
- Il C con cedilla (ç) è presente solo in maiuscolo nell&#39;alfabeto GSM7, ma alcuni telefoni lo rendono in minuscolo o nel caso &quot;intelligente&quot;: la raccomandazione generale è di evitarlo completamente e rimuovere il cedilla (è ancora molto leggibile in francese) o passare a UCS-2.
- Non utilizzare ASCII in SMS, a meno che non sia esplicitamente richiesto dal partner SMS-C: questa codifica spreca spazio perché ha caratteri a 8 bit e una copertura inferiore rispetto a GSM7.
- Latin-1 non è sempre supportato: controlla la compatibilità con il tuo partner SMS-C prima di tentare di utilizzare Latin-1.
- Le tabelle di spostamento della lingua nazionale non sono supportate dal connettore Adobe Campaign Classic. È invece necessario utilizzare UCS-2.
- UCS-2 e UTF-16 sono spesso mescolati da telefoni. Questo è un problema per le persone che inviano emoji e altri caratteri raramente usati non presenti in UCS-2.
- La codifica GSM7 non è supportata da [!DNL Wireshark]: i caratteri speciali non verranno visualizzati correttamente. Per verificare se una stringa GSM7 è codificata correttamente, è necessario confrontare i codici esadecimali con la tabella GSM7.


La *`data_coding`* indica la codifica utilizzata. L’unico problema è che il valore 0 indica la codifica SMS-C predefinita nella specifica, ma in generale significa GSM7. Controlla con il partner SMS-C *a quale codifica è associata `data_coding = 0` (Adobe Campaign supporta solo GSM7 per `data_coding* = 0`).

La dimensione massima di un messaggio dipende dalla relativa codifica. Questa tabella riassume tutte le informazioni pertinenti:
<br><br><br><br> <br>

| Codifica | data_coding | Dimensioni del messaggio (caratteri)  | Dimensione della parte per SMS multiparte  | Caratteri disponibili  |
| --- | --- | --- | --- | --- |
| GSM7 | 0 | 160 | 152 | [Set di caratteri di base GSM7 + estensione](https://en.wikipedia.org/wiki/GSM_03.38) (i caratteri estesi contengono 2 caratteri)  |
| Latino-1  | 3 | 140 | 134 | ISO-8859-1 |
| UTF-16 UCS-2  | 8 | 70 | 67 | Unicode (varia da telefono a telefono) |

<br><br><br><br><br>Intestazione dati utente (UDH)<br><br><br><br><br><br>
UDH (User Data Header) sono piccole intestazioni binarie aggiunte al testo di un SMS. Possono attivare funzioni speciali come concatenazione di SMS, tabelle di spostamento della lingua nazionale, loghi/immagini (raramente utilizzati) o push WAP.

Poiché l’UDH fa parte del campo di testo (campo SMPP a_messaggio breve), riduce la dimensione effettiva di un SMS. Ad esempio, un SMS concatenato UDH consumerà 6 byte per parte SMS (ossia 6 byte reali a 8 bit, non 7 bit), lasciando spazio sufficiente per soli 152 caratteri a 7 bit per parte messaggio.

[!DNL Wikipedia] Ha bei articoli su User Data Header e Concatenated SMS (in inglese).

Per sapere se un messaggio_breve contiene un UDH, controllare i bit 6 e 7 di esm_class (vedere la sezione 5.2.12 della specifica). [!DNL Wireshark] analizza l&#39;UDH nell&#39;interfaccia e fornisce informazioni precise.
![smpp7](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_738682084/smpp7.png "smpp7")
Nella schermata precedente, puoi vedere l’intestazione dei dati utente nel campo messaggio (1), le informazioni contenute nell’UDH (2) e alcune informazioni aggiuntive non appartenenti al pacchetto ma calcolate da [!DNL Wireshark] (3) il campo Corpo messaggio breve è particolarmente interessante in quanto contiene il messaggio completo riassemblato da [!DNL Wireshark].
<br><br><br><br><br><br>Ricevitore SR<br><br><br><br><br><br>
Quando il destinatario è vincolato, l’SMS-C può inviare SR in qualsiasi momento. L&#39;SR viene inviato utilizzando una PDU DELIVER_SM con bit 2-5 di *`esm_class`*impostare.
![smpp8](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_158644074/smpp8.png "smpp8")
La *`DELIVER_SM`* La PDU deve ricevere una risposta rapida da un *`DELIVER_SM_RESP`* PDU con lo stesso *`sequence_number`*. Per trovare il MT corrispondente a questo SR, cerca un *`SUBMIT_SM_RESP`* con lo stesso ID. Ad esempio, questo è il MT che corrisponde all&#39;SR:
![smpp9](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_1012110897/smpp9.png "smpp9")
L&#39;SR viene inviato solo se *`registered_delivery`* campo impostato nel MT.

Nota:

Il connettore Adobe Campaign Classic SMPP non gestisce SR che arriva prima del *`SUBMIT_SM_RESP`* pacchetto. La specifica non vieta esplicitamente questo comportamento, ma è considerata un comportamento scorretto (significa che il messaggio è stato ricevuto prima di essere inviato). Se incontri questo caso troppo spesso, chiedi al tuo partner SMS-C di riparare la sua piattaforma.
<br><br><br><br><br><br>Decifrazione del campo short_message di SR<br><br><br><br><br><br>
Il campo di testo delle PDU SR ha una codifica speciale descritta nell&#39;appendice B della specifica del protocollo SMPP. Purtroppo, questo formato è solo una raccomandazione senza essere parte del protocollo, anche se la maggior parte degli SMS-C rispettano più o meno questo stesso formato.

Dovresti chiedere direttamente al partner SMS-C di avere una documentazione della sua implementazione e verificare che corrisponda a quanto visualizzato in [!DNL Wireshark]. Più spesso, gli implementatori di SMS-C non conoscono nemmeno la loro implementazione e questo porta a problemi e malintesi. Non esitare a chiedere aiuto al partner SMS-C in caso di dubbi su questo campo (in particolare sui codici di errore).

Il formato di base è il seguente:

*`id:IIIIIIIIII sub:SSS dlvrd:DDD submit date:YYMMDDhhmm done date:YYMMDDhhmm stat:DDDDDDD err:EEE`*

*`Text:........`*

Queste sono le linee guida generali per la lettura della riga precedente:

- L&#39;ID è lo stesso inviato nel *`SUBMIT_SM_RESP`*dell&#39;MT corrispondente.
- È possibile ignorare i problemi nella `text` campo: questo campo viene ignorato da [!DNL Campaign] perché è inutile, inaffidabile e può anche essere del tutto illeggibile se l’SMS è stato inviato utilizzando un’altra codifica che non ASCII alfanumerico puro. Questo è un comportamento normale.
- I nomi dei campi non fanno distinzione tra maiuscole e minuscole (ad esempio, `id`: `sub`: `Text`: può anche essere annotato come `ID`: `SUB`: `text`:).
- *`dlvrd`*Il campo non è generalmente affidabile, a meno che non sia documentato dal partner SMS-C.
- Le date possono avere qualsiasi fuso orario, rendendole praticamente inutili, o semplicemente sbagliate perché l&#39;orologio del server remoto è spento.
- *`stat`*il campo può avere valori diversi da quelli definiti nell&#39;appendice B. Utilizza il buon senso e la documentazione del partner SMSC per comprenderne il significato.
- *`err`*Il campo è completamente dipendente dall&#39;SMS-C e per la maggior parte del tempo documentato dal partner SMS-C. Spesso, il codice 000 indica un successo, mentre qualsiasi altro codice indica errori. Il campo è spesso numerico, ma può anche essere esadecimale.

<br><br><br><br><br><br>SR multipli per lo stesso MT<br><br><br><br><br><br>
Alcuni SMS-C inviano più SR per lo stesso MT per monitorare la progressione del MT nella rete. Questo è inutile soprattutto perché la maggior parte delle volte il cliente vuole sapere solo quando il messaggio è stato ricevuto (in genere è l&#39;ultimo SR).

In caso di dubbi, utilizza solo l’ultimo SR ricevuto dall’SMS-C per trovare lo stato di un messaggio.
<br><br><br><br><br><br>Finestra SMPP<br><br><br><br><br><br>
Poiché le operazioni e le risposte sono asincrone, è possibile ottimizzare i tassi di trasferimento inviando più PDU delle operazioni prima di attendere le risposte. Il numero di messaggi privi di risposta viene chiamato finestra.

Esempio di trasmissione con finestra massima 4:
![smpp10](https://helpx.adobe.com/content/dam/help/en/campaign/kb/smpp-protocol-wireshark/jcr_content/main-pars/image_2072040949/smpp10.png "smpp10")
L’implementazione corrente non controlla la finestra e prevede che l’SMS-C remoto sia abbastanza veloce da gestire MT.
